From dc363000ee8ab230a32ebf49654e1524b7b004a7 Mon Sep 17 00:00:00 2001
From: Jason Rogena <j.rogena@cgiar.org>
Date: Mon, 16 Jun 2014 18:44:51 +0300
Subject: [PATCH 202/213] Version 1.0.3: Farmer site and activity

Admins can now set farmer's site and can also edit the is_active
flag for the farmer
---
 .../ilri/mistro/farmer/EditFarmerActivity.java     |  6 +++---
 .../mistro/farmer/FarmerRegistrationActivity.java  | 25 +++++++++++++++++++++-
 .../res/layout/activity_farmer_registration.xml    | 14 ++++++++++++
 3 files changed, 41 insertions(+), 4 deletions(-)

diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EditFarmerActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EditFarmerActivity.java
index 8e053d5..98683f0 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EditFarmerActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EditFarmerActivity.java
@@ -148,7 +148,7 @@ public class EditFarmerActivity extends SherlockActivity implements MistroActivi
     public void initTextInViews() {
         setTitle(Locale.getStringInLocale("edit_farmer", this));
         fullNameTV.setText(" * " + Locale.getStringInLocale("full_name", this));
-        extensionPersonnelTV.setText(Locale.getStringInLocale("extension_p", this));
+        extensionPersonnelTV.setText(" * " + Locale.getStringInLocale("extension_p", this));
 
         List<String> tmpVetNames = new ArrayList<String>();
         tmpVetNames.add("");
@@ -165,13 +165,13 @@ public class EditFarmerActivity extends SherlockActivity implements MistroActivi
 
         recordLocB.setText(Locale.getStringInLocale("rec_farm_loc", this));
 
-        siteTV.setText(Locale.getStringInLocale("site", this));
+        siteTV.setText(" * " + Locale.getStringInLocale("site", this));
 
         ArrayAdapter<String> siteArrayAdapter = new ArrayAdapter<String>(this,android.R.layout.simple_spinner_item, getResources().getStringArray(R.array.sites));
         siteArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
         siteS.setAdapter(siteArrayAdapter);
 
-        isActiveTV.setText(Locale.getStringInLocale("is_active", this));
+        isActiveTV.setText(" * " + Locale.getStringInLocale("is_active", this));
 
         ArrayAdapter<String> isActiveArrayAdapter = new ArrayAdapter<String>(this,android.R.layout.simple_spinner_item, Locale.getArrayInLocale("yes_no", this));
         isActiveArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FarmerRegistrationActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FarmerRegistrationActivity.java
index 65948ae..d916137 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FarmerRegistrationActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FarmerRegistrationActivity.java
@@ -53,6 +53,8 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
     private Spinner preferredLanguageS;
     private TextView extensionPersonnelTV;
     private Spinner extensionPersonnelS;
+    private TextView siteTV;
+    private Spinner siteS;
     private TextView mobileNumberTV;
     private EditText mobileNumberET;
     private TextView numberOfCowsTV;
@@ -96,6 +98,8 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
         mobileNumberTV=(TextView)this.findViewById(R.id.mobile_number_tv);
         mobileNumberET=(EditText)this.findViewById(R.id.mobile_number_et);
         TelephonyManager telephonyManager=(TelephonyManager)this.getSystemService(Context.TELEPHONY_SERVICE);
+        siteTV = (TextView)this.findViewById(R.id.site_tv);
+        siteS = (Spinner)this.findViewById(R.id.site_s);
         //Toast.makeText(this,telephonyManager.getSimSerialNumber(),Toast.LENGTH_LONG).show();
         mobileNumberET.setText(telephonyManager.getLine1Number());
         numberOfCowsTV=(TextView)this.findViewById(R.id.number_of_cows_tv);
@@ -193,6 +197,13 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
 
             Log.d(TAG, "Preferred locale: "+farmer.getPreferredLocale());
 
+            String[] sites = this.getResources().getStringArray(R.array.sites);
+            for(int i = 0; i < sites.length;i++){
+                if(sites[i].equals(farmer.getSite())){
+                    siteS.setSelection(i);
+                }
+            }
+
             Log.d(TAG,"Extension Personnel: "+farmer.getExtensionPersonnel());
             mobileNumberET.setText(farmer.getMobileNumber());
             Log.d(TAG,"Mobile number: "+farmer.getMobileNumber());
@@ -229,10 +240,14 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
     {
         setTitle(Locale.getStringInLocale("farmer_registration", this));
         fullNameTV.setText(" * " + Locale.getStringInLocale("full_name", this));
-        extensionPersonnelTV.setText(Locale.getStringInLocale("extension_p", this));
+        extensionPersonnelTV.setText(" * " + Locale.getStringInLocale("extension_p", this));
         mobileNumberTV.setText(" * " + Locale.getStringInLocale("mobile_number", this));
         numberOfCowsTV.setText(" * "+Locale.getStringInLocale("number_of_cows",this));
         preferredLanguageTV.setText(" * "+Locale.getStringInLocale("preferred_language", this));
+        siteTV.setText(" * "+Locale.getStringInLocale("site", this));
+        ArrayAdapter<String> siteArrayAdapter = new ArrayAdapter<String>(this, android.R.layout.simple_spinner_item, getResources().getStringArray(R.array.sites));
+        siteArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+        siteS.setAdapter(siteArrayAdapter);
 
         ArrayAdapter<String> languageAdapter = new ArrayAdapter<String>(this,android.R.layout.simple_spinner_item, languages);
         languageAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
@@ -284,6 +299,8 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
             farmer.setLatitude("");
             farmer.setLongitude("");
         }
+        String[] sites = getResources().getStringArray(R.array.sites);
+        farmer.setSite(sites[siteS.getSelectedItemPosition()]);
         farmer.setMode(Farmer.MODE_INITIAL_REGISTRATION);
         TelephonyManager telephonyManager=(TelephonyManager)this.getSystemService(Context.TELEPHONY_SERVICE);
         farmer.setSimCardSN(telephonyManager.getSimSerialNumber());
@@ -411,6 +428,12 @@ public class FarmerRegistrationActivity extends SherlockActivity implements Mist
             return  false;
         }
 
+        String[] sites = getResources().getStringArray(R.array.sites);
+        if(siteS.getSelectedItemPosition() != -1 && sites[siteS.getSelectedItemPosition()].length() == 0){
+            Toast.makeText(this, Locale.getStringInLocale("specify_site", this), Toast.LENGTH_LONG).show();
+            return false;
+        }
+
         if(isInFarm && (longitude == null || longitude.length() == 0 || latitude == null || latitude.length() == 0)) {
             //Toast.makeText(this,Locale.getStringInLocale("gps_narrowing_down_on_loc",this),Toast.LENGTH_LONG).show();
             //return false;
diff --git a/MistroFarmer/src/main/res/layout/activity_farmer_registration.xml b/MistroFarmer/src/main/res/layout/activity_farmer_registration.xml
index 515503d..289118a 100644
--- a/MistroFarmer/src/main/res/layout/activity_farmer_registration.xml
+++ b/MistroFarmer/src/main/res/layout/activity_farmer_registration.xml
@@ -71,6 +71,20 @@
             android:textSize="@dimen/normal_text_size"
             android:textColor="@color/text_input_color" />
         <TextView
+            android:id="@+id/site_tv"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:textSize="@dimen/normal_text_size"
+            android:layout_marginTop="@dimen/activity_f_r_text_view_margin_top"/>
+        <Spinner
+            android:id="@+id/site_s"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="@dimen/activity_f_r_edit_text_margin_top"
+            android:layout_marginLeft="@dimen/activity_f_r_edit_text_margin_left"
+            android:textSize="@dimen/normal_text_size"
+            android:textColor="@color/text_input_color" />
+        <TextView
             android:id="@+id/number_of_cows_tv"
             android:layout_width="wrap_content"
             android:layout_height="wrap_content"
-- 
2.7.1

