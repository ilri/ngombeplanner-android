From f02193e1bac86834506903d90f2202539f307da7 Mon Sep 17 00:00:00 2001
From: Jason Rogena <j.rogena@cgiar.org>
Date: Tue, 1 Apr 2014 10:09:36 +0300
Subject: [PATCH 136/213] Version 0.8 Revision 11: Added a back/cancel button
 to all the activities that need it

---
 MistroFarmer/src/main/AndroidManifest.xml          |  2 +-
 .../cgiar/ilri/mistro/farmer/AddEventActivity.java | 39 ++++++++++++++++++++--
 .../mistro/farmer/AddMilkProductionActivity.java   | 28 +++++++++++++++-
 .../cgiar/ilri/mistro/farmer/EventsActivity.java   | 29 ++++++++++++++--
 .../ilri/mistro/farmer/EventsHistoryActivity.java  | 18 ++++++++++
 .../ilri/mistro/farmer/FertilityActivity.java      | 27 +++++++++++++++
 .../cgiar/ilri/mistro/farmer/LandingActivity.java  |  2 +-
 .../org/cgiar/ilri/mistro/farmer/MainMenu.java     |  9 +++++
 .../farmer/MilkProcutionHistoryActivity.java       | 17 ++++++++++
 .../ilri/mistro/farmer/MilkProductionActivity.java | 26 +++++++++++++++
 .../ilri/mistro/farmer/backend/DataHandler.java    |  2 ++
 .../src/main/res/layout/activity_add_event.xml     | 31 ++++++++++++-----
 .../res/layout/activity_add_milk_production.xml    | 33 +++++++++++++-----
 .../src/main/res/layout/activity_events.xml        |  7 ++++
 .../src/main/res/layout/activity_fertility.xml     |  8 ++++-
 .../src/main/res/layout/activity_main_menu.xml     |  7 ++++
 .../main/res/layout/activity_milk_production.xml   |  8 ++++-
 MistroFarmer/src/main/res/menu/add_event.xml       |  3 ++
 .../src/main/res/menu/add_milk_production.xml      |  3 ++
 MistroFarmer/src/main/res/menu/events.xml          |  3 ++
 MistroFarmer/src/main/res/menu/events_history.xml  |  3 ++
 MistroFarmer/src/main/res/menu/fertility.xml       | 15 ++++++---
 .../src/main/res/menu/milk_procution_history.xml   |  3 ++
 MistroFarmer/src/main/res/menu/milk_production.xml |  3 ++
 MistroFarmer/src/main/res/values/dimens.xml        |  1 +
 MistroFarmer/src/main/res/values/strings_en.xml    |  3 ++
 MistroFarmer/src/main/res/values/strings_sw.xml    |  3 ++
 27 files changed, 303 insertions(+), 30 deletions(-)

diff --git a/MistroFarmer/src/main/AndroidManifest.xml b/MistroFarmer/src/main/AndroidManifest.xml
index 8de8528..1afcecc 100644
--- a/MistroFarmer/src/main/AndroidManifest.xml
+++ b/MistroFarmer/src/main/AndroidManifest.xml
@@ -2,7 +2,7 @@
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
     package="org.cgiar.ilri.mistro.farmer"
     android:versionCode="2"
-    android:versionName="0.8.10" >
+    android:versionName="0.8.11" >
 
     <uses-sdk
         android:minSdkVersion="7"
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
index 8c30132..a2ea083 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
@@ -54,6 +54,7 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
     public static final String MODE_CALVING="Birth";
     public static final String KEY_SERVICING_TYPE="servicingType";
 
+    private Menu menu;
     private TextView cowIdentifierTV;
     private Spinner cowIdentifierS;
     private TextView dateTV;
@@ -65,6 +66,7 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
     private TextView remarksTV;
     private EditText remarksET;
     private Button okayB;
+    private Button cancelB;
     private DatePickerDialog datePickerDialog;
     private TextView strawNumberTV;
     private EditText strawNumberET;
@@ -144,6 +146,8 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         liveBirthsET = (EditText)findViewById(R.id.live_births_et);*/
         okayB=(Button)findViewById(R.id.okay_b);
         okayB.setOnClickListener(this);
+        cancelB = (Button)findViewById(R.id.cancel_b);
+        cancelB.setOnClickListener(this);
 
         initTextInViews();
         fetchCowIdentifiers();
@@ -186,6 +190,8 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
     public boolean onCreateOptionsMenu(Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.add_event, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -202,6 +208,11 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -328,6 +339,17 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         loadingPleaseWait = Locale.getStringInLocale("loading_please_wait",this);
         servicingTV.setText(Locale.getStringInLocale("associated_servicing",this));
         //liveBirthsTV.setText(Locale.getStringInLocale("previous_live_births",this));
+
+        cancelB.setText(Locale.getStringInLocale("cancel", this));
+
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     private void fetchCowIdentifiers()
@@ -358,6 +380,17 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         {
             dateETClicked();
         }
+        else if(view == cancelB){
+            Intent intent;
+            if(presetMode != null && (presetMode.equals(MODE_CALVING) || presetMode.equals(MODE_SERVICING))){
+                intent = new Intent(this, FertilityActivity.class);
+            }
+            else{
+                intent = new Intent(this, EventsActivity.class);
+            }
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 
     private void eventTypeSelected(){
@@ -884,7 +917,8 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
                 //TODO: warn user if no cows
                 if(cowArray.length==0)
                 {
-                    Toast.makeText(AddEventActivity.this, Locale.getStringInLocale("no_data_received",AddEventActivity.this), Toast.LENGTH_LONG).show();
+                    //Toast.makeText(AddEventActivity.this, Locale.getStringInLocale("no_data_received",AddEventActivity.this), Toast.LENGTH_LONG).show();
+                    Log.w(TAG, "No data received from the server");
                 }
                 AddEventActivity.this.cowNameArray =cowArray;
                 AddEventActivity.this.cowEarTagNumberArray=earTagArray;
@@ -950,7 +984,8 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
                 Toast.makeText(AddEventActivity.this, Locale.getStringInLocale("problem_connecting_to_server",AddEventActivity.this), Toast.LENGTH_LONG).show();
             }
             else if(result.equals(DataHandler.NO_DATA)) {
-                Toast.makeText(AddEventActivity.this, Locale.getStringInLocale("no_data_received",AddEventActivity.this), Toast.LENGTH_LONG).show();
+                //Toast.makeText(AddEventActivity.this, Locale.getStringInLocale("no_data_received",AddEventActivity.this), Toast.LENGTH_LONG).show();
+                Log.w(TAG, "No data received from the server");
             }
             else {
                 try {
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddMilkProductionActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddMilkProductionActivity.java
index 41c87d7..0d9ccb1 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddMilkProductionActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddMilkProductionActivity.java
@@ -11,7 +11,7 @@ import android.os.Bundle;
 import android.app.Activity;
 import android.telephony.TelephonyManager;
 import android.util.Log;
-import android.view.Menu;
+import com.actionbarsherlock.view.Menu;
 import android.view.View;
 import android.widget.ArrayAdapter;
 import android.widget.Button;
@@ -54,11 +54,13 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
     private TextView quantityTypeTV;
     private Spinner quantityTypeS;
     private Button addMilkProductionAddB;
+    private Button cancelB;
     /*private TextView noMilkingTV;
     private EditText noMilkingET;
     private TextView calfSucklingTV;
     private Spinner calfSucklingS;*/
     private DatePickerDialog datePickerDialog;
+    private Menu menu;
 
     private String[] cowNameArray;
     private String[] cowEarTagNumberArray;
@@ -88,6 +90,8 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
         calfSucklingTV = (TextView)this.findViewById(R.id.calf_suckling_tv);
         calfSucklingS = (Spinner)this.findViewById(R.id.calf_suckling_s);*/
         addMilkProductionAddB.setOnClickListener(this);
+        cancelB = (Button)this.findViewById(R.id.cancel_b);
+        cancelB.setOnClickListener(this);
 
         initTextInViews();
         fetchCowIdentifiers();
@@ -110,6 +114,8 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
     public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.milk_production, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -126,6 +132,11 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -161,6 +172,7 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
         if(defaultQuantityTypeIndex < quantityTypes.length)
             quantityTypeS.setSelection(defaultQuantityTypeIndex);
 
+        cancelB.setText(Locale.getStringInLocale("cancel", this));
 
         //noMilkingTV.setText(Locale.getStringInLocale("no_times_milked_in_a_day",this));
         //calfSucklingTV.setText(Locale.getStringInLocale("calf_suckling",this));
@@ -169,6 +181,15 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
         ArrayAdapter<String> calfSucklingTypesArrayAdapter = new ArrayAdapter<String>(this,android.R.layout.simple_spinner_item,calfSucklingTypes);
         calfSucklingTypesArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
         calfSucklingS.setAdapter(calfSucklingTypesArrayAdapter);*/
+
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     @Override
@@ -179,6 +200,11 @@ public class AddMilkProductionActivity extends SherlockActivity implements View.
         else if(view==dateET) {
             dateETClicked();
         }
+        else if(view == cancelB){
+            Intent intent = new Intent(this, MilkProductionActivity.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 
     private void dateETClicked() {
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsActivity.java
index b84f375..3f988a8 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsActivity.java
@@ -3,7 +3,7 @@ package org.cgiar.ilri.mistro.farmer;
 import android.content.Intent;
 import android.os.Bundle;
 import android.app.Activity;
-import android.view.Menu;
+import com.actionbarsherlock.view.Menu;
 import android.view.View;
 import android.widget.Button;
 import android.widget.Toast;
@@ -17,8 +17,10 @@ import org.cgiar.ilri.mistro.farmer.backend.Locale;
 public class EventsActivity extends SherlockActivity implements View.OnClickListener
 {
 
+    private Menu menu;
     private Button addEventB;
     private Button eventHistoryB;
+    private Button backB;
     @Override
     protected void onCreate(Bundle savedInstanceState)
     {
@@ -29,13 +31,17 @@ public class EventsActivity extends SherlockActivity implements View.OnClickList
         addEventB.setOnClickListener(this);
         eventHistoryB=(Button)findViewById(R.id.event_history_b);
         eventHistoryB.setOnClickListener(this);
+        backB = (Button)findViewById(R.id.back_b);
+        backB.setOnClickListener(this);
 
         initTextInViews();
     }
 
-    public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
+    public boolean onCreateOptionsMenu(Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.events, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -52,6 +58,11 @@ public class EventsActivity extends SherlockActivity implements View.OnClickList
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -60,6 +71,15 @@ public class EventsActivity extends SherlockActivity implements View.OnClickList
         setTitle(Locale.getStringInLocale("events",this));
         addEventB.setText(Locale.getStringInLocale("add_an_event",this));
         eventHistoryB.setText(Locale.getStringInLocale("past_events",this));
+        backB.setText(Locale.getStringInLocale("back", this));
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     @Override
@@ -75,5 +95,10 @@ public class EventsActivity extends SherlockActivity implements View.OnClickList
             Intent intent=new Intent(this,EventsHistoryActivity.class);
             startActivity(intent);
         }
+        else if(view == backB){
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 }
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsHistoryActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsHistoryActivity.java
index 1421e74..73c6e1e 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsHistoryActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/EventsHistoryActivity.java
@@ -2,6 +2,7 @@ package org.cgiar.ilri.mistro.farmer;
 
 import android.app.ProgressDialog;
 import android.content.Context;
+import android.content.Intent;
 import android.os.AsyncTask;
 import android.os.Bundle;
 import android.telephony.TelephonyManager;
@@ -36,6 +37,7 @@ import java.util.List;
 public class EventsHistoryActivity extends SherlockActivity {
     private static final String TAG="EventsHistoryActivity";
 
+    private Menu menu;
     private TableLayout eventsHistoryTL;
     private TextView dateTV;
     private TextView cowNameTV;
@@ -71,6 +73,8 @@ public class EventsHistoryActivity extends SherlockActivity {
     public boolean onCreateOptionsMenu(Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.events_history, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -87,6 +91,11 @@ public class EventsHistoryActivity extends SherlockActivity {
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -105,6 +114,15 @@ public class EventsHistoryActivity extends SherlockActivity {
             eventTypes = new String[1];
             eventTypes[0] = "";
         }
+
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     private void fetchEventsHistory() {
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FertilityActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FertilityActivity.java
index d86c007..9f09759 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FertilityActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/FertilityActivity.java
@@ -8,6 +8,7 @@ import android.widget.Button;
 import android.widget.Toast;
 
 import com.actionbarsherlock.app.SherlockActivity;
+import com.actionbarsherlock.view.Menu;
 import com.actionbarsherlock.view.MenuInflater;
 import com.actionbarsherlock.view.MenuItem;
 
@@ -16,8 +17,10 @@ import org.cgiar.ilri.mistro.farmer.carrier.Cow;
 
 public class FertilityActivity extends SherlockActivity implements View.OnClickListener{
 
+    private Menu menu;
     private Button servicingB;
     private Button calvingB;
+    private Button backB;
 
     private Dialog servicingTypeDialog;
     private Button bullB;
@@ -34,6 +37,9 @@ public class FertilityActivity extends SherlockActivity implements View.OnClickL
         calvingB = (Button) this.findViewById(R.id.calving_b);
         calvingB.setOnClickListener(this);
 
+        backB = (Button) this.findViewById(R.id.back_b);
+        backB.setOnClickListener(this);
+
         servicingTypeDialog =new Dialog(this);
         servicingTypeDialog.setContentView(R.layout.dialog_servicing_type);
         bullB =(Button) servicingTypeDialog.findViewById(R.id.bull_b);
@@ -47,6 +53,8 @@ public class FertilityActivity extends SherlockActivity implements View.OnClickL
     public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.milk_production, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -63,6 +71,11 @@ public class FertilityActivity extends SherlockActivity implements View.OnClickL
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -73,6 +86,15 @@ public class FertilityActivity extends SherlockActivity implements View.OnClickL
         servicingTypeDialog.setTitle(Locale.getStringInLocale("select_service_type",this));
         aiB.setText(Locale.getStringInLocale("artificial_inseminamtion",this));
         bullB.setText(Locale.getStringInLocale("bull_servicing",this));
+        backB.setText(Locale.getStringInLocale("back", this));
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     @Override
@@ -99,5 +121,10 @@ public class FertilityActivity extends SherlockActivity implements View.OnClickL
             servicingTypeDialog.dismiss();
             startActivity(intent);
         }
+        else if(view == backB){
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 }
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
index c5ddb22..6940240 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
@@ -77,7 +77,7 @@ public class LandingActivity extends SherlockActivity implements View.OnClickLis
 
         //init text according to locale
         initTextInViews();
-        Toast.makeText(this, "Version 0.8 Revision 10", Toast.LENGTH_LONG).show();
+        Toast.makeText(this, "Version 0.8 Revision 11", Toast.LENGTH_LONG).show();
     }
 
     public boolean onCreateOptionsMenu(Menu menu) {
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MainMenu.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MainMenu.java
index 1f361e2..212912e 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MainMenu.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MainMenu.java
@@ -35,6 +35,7 @@ public class MainMenu extends SherlockActivity implements View.OnClickListener,
     private Button milkProductionB;
     private Button fertilityB;
     private Button eventsB;
+    private Button logoutB;
     private String regLatitude;
     private String regLongitude;
     private LocationManager locationManager;
@@ -53,6 +54,8 @@ public class MainMenu extends SherlockActivity implements View.OnClickListener,
         fertilityB.setOnClickListener(this);
         eventsB =(Button)this.findViewById(R.id.events_b);
         eventsB.setOnClickListener(this);
+        logoutB = (Button)this.findViewById(R.id.logout_b);
+        logoutB.setOnClickListener(this);
 
         Bundle bundle=this.getIntent().getExtras();
         if(bundle != null){
@@ -92,6 +95,7 @@ public class MainMenu extends SherlockActivity implements View.OnClickListener,
         milkProductionB.setText(Locale.getStringInLocale("milk_production", this));
         fertilityB.setText(Locale.getStringInLocale("fertility",this));
         eventsB.setText(Locale.getStringInLocale("events",this));
+        logoutB.setText(Locale.getStringInLocale("logout", this));
     }
 
     @Override
@@ -111,6 +115,11 @@ public class MainMenu extends SherlockActivity implements View.OnClickListener,
             Intent intent=new Intent(this,EventsActivity.class);
             startActivity(intent);
         }
+        else if(view==logoutB){
+            Intent intent = new Intent(this, LandingActivity.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 
     private void registerCoords(){
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProcutionHistoryActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProcutionHistoryActivity.java
index 96f69b7..dea6196 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProcutionHistoryActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProcutionHistoryActivity.java
@@ -2,6 +2,7 @@ package org.cgiar.ilri.mistro.farmer;
 
 import android.app.ProgressDialog;
 import android.content.Context;
+import android.content.Intent;
 import android.os.AsyncTask;
 import android.os.Bundle;
 import android.telephony.TelephonyManager;
@@ -36,6 +37,7 @@ import java.util.List;
 public class MilkProcutionHistoryActivity extends SherlockActivity
 {
     private static final String TAG="MIlkProductionHistoryActivity";
+    private Menu menu;
     private TextView dateTV;
     private TextView cowNameTV;
     private TextView timeTV;
@@ -72,6 +74,8 @@ public class MilkProcutionHistoryActivity extends SherlockActivity
     public boolean onCreateOptionsMenu(Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.milk_procution_history, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -88,6 +92,11 @@ public class MilkProcutionHistoryActivity extends SherlockActivity
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -106,6 +115,14 @@ public class MilkProcutionHistoryActivity extends SherlockActivity
         todayText=Locale.getStringInLocale("today",this);
         yesterdayText=Locale.getStringInLocale("yesterday",this);
         loadingPleaseWait=Locale.getStringInLocale("loading_please_wait",this);
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     private void fetchProductionHistory()
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProductionActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProductionActivity.java
index cefa497..a1f089e 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProductionActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/MilkProductionActivity.java
@@ -41,8 +41,10 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
     private final String dateFormat="dd/MM/yyyy";
 
     private static final String TAG="MilkProductionActivity";
+    private Menu menu;
     private Button addProductionB;
     private Button productionHistoryB;
+    private Button backB;
     private Dialog addMilkProductionDialog;
     private TextView cowTV;
     private Spinner cowS;
@@ -80,6 +82,8 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
         addProductionB.setOnClickListener(this);
         productionHistoryB =(Button)this.findViewById(R.id.production_history_b);
         productionHistoryB.setOnClickListener(this);
+        backB = (Button)this.findViewById(R.id.back_b);
+        backB.setOnClickListener(this);
         addMilkProductionDialog=new Dialog(this);
         addMilkProductionDialog.setContentView(R.layout.dialog_add_milk_production);
         cowTV=(TextView)addMilkProductionDialog.findViewById(R.id.cow_tv);
@@ -107,6 +111,8 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
     public boolean onCreateOptionsMenu(Menu menu) {
         MenuInflater inflater = getSupportMenuInflater();
         inflater.inflate(R.menu.milk_production, menu);
+        this.menu = menu;
+        initMenuText();
         return true;
     }
 
@@ -123,6 +129,11 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
             Toast.makeText(this, "kazi katika maendeleo", Toast.LENGTH_LONG).show();
             return true;
         }
+        else if(item.getItemId() == R.id.action_back_main_menu) {
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
         return false;
     }
 
@@ -172,6 +183,16 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
         ArrayAdapter<String> calfSucklingTypesArrayAdapter = new ArrayAdapter<String>(this,android.R.layout.simple_spinner_item,calfSucklingTypes);
         calfSucklingTypesArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
         calfSucklingS.setAdapter(calfSucklingTypesArrayAdapter);
+        backB.setText(Locale.getStringInLocale("back", this));
+
+        initMenuText();
+    }
+
+    private void initMenuText(){
+        if(this.menu != null){
+            MenuItem mainMenuMI = menu.findItem(R.id.action_back_main_menu);
+            mainMenuMI.setTitle(Locale.getStringInLocale("back_to_main_menu", this));
+        }
     }
 
     @Override
@@ -195,6 +216,11 @@ public class MilkProductionActivity extends SherlockActivity implements View.OnC
         else if(view==dateET) {
             dateETClicked();
         }
+        else if(view==backB){
+            Intent intent = new Intent(this, MainMenu.class);
+            intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
+            startActivity(intent);
+        }
     }
 
     private void dateETClicked()
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/backend/DataHandler.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/backend/DataHandler.java
index ec8075f..e2506e7 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/backend/DataHandler.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/backend/DataHandler.java
@@ -323,6 +323,7 @@ public class DataHandler
         SharedPreferences.Editor editor = context.getSharedPreferences(context.getString(R.string.app_name),Context.MODE_PRIVATE).edit();
         editor.putString(sharedPreferenceKey,value);
         editor.commit();
+        Log.d(TAG, sharedPreferenceKey+" shared preference saved as "+value);
     }
 
     /**
@@ -337,6 +338,7 @@ public class DataHandler
      */
     public static String getSharedPreference(Context context, String sharedPreferenceKey, String defaultValue) {
         SharedPreferences sharedPreferences = context.getSharedPreferences(context.getString(R.string.app_name), Context.MODE_PRIVATE);
+        Log.d(TAG, "value of "+sharedPreferenceKey+" is "+sharedPreferences.getString(sharedPreferenceKey, defaultValue));
         return sharedPreferences.getString(sharedPreferenceKey, defaultValue);
     }
 
diff --git a/MistroFarmer/src/main/res/layout/activity_add_event.xml b/MistroFarmer/src/main/res/layout/activity_add_event.xml
index 35e6b81..5004e80 100644
--- a/MistroFarmer/src/main/res/layout/activity_add_event.xml
+++ b/MistroFarmer/src/main/res/layout/activity_add_event.xml
@@ -248,15 +248,30 @@
             android:textColor="@color/text_input_color"
             android:gravity="top"
             android:inputType="textMultiLine|textCapSentences"/>
-        <Button
-            android:id="@+id/okay_b"
-            android:layout_width="wrap_content"
+        <LinearLayout
+            android:layout_width="match_parent"
             android:layout_height="@dimen/normal_button_layout_height"
-            android:layout_marginTop="15dp"
-            android:layout_gravity="bottom|right"
-            android:paddingLeft="@dimen/normal_button_padding_side"
-            android:paddingRight="@dimen/normal_button_padding_side"
-            android:textSize="@dimen/normal_text_size"/>
+            android:orientation="horizontal"
+            android:layout_marginTop="40dp"
+            android:layout_gravity="bottom">
+            <Button
+                android:id="@+id/cancel_b"
+                android:layout_width="wrap_content"
+                android:layout_height="@dimen/normal_button_layout_height"
+                android:paddingLeft="@dimen/normal_button_padding_side"
+                android:paddingRight="@dimen/normal_button_padding_side"
+                android:textSize="@dimen/normal_text_size"
+                android:layout_weight="1"/>
+            <Button
+                android:id="@+id/okay_b"
+                android:layout_width="wrap_content"
+                android:layout_height="@dimen/normal_button_layout_height"
+                android:paddingLeft="@dimen/normal_button_padding_side"
+                android:paddingRight="@dimen/normal_button_padding_side"
+                android:textSize="@dimen/normal_text_size"
+                android:layout_weight="1"/>
+        </LinearLayout>
+
 
     </LinearLayout>
 
diff --git a/MistroFarmer/src/main/res/layout/activity_add_milk_production.xml b/MistroFarmer/src/main/res/layout/activity_add_milk_production.xml
index 8e331a0..776986b 100644
--- a/MistroFarmer/src/main/res/layout/activity_add_milk_production.xml
+++ b/MistroFarmer/src/main/res/layout/activity_add_milk_production.xml
@@ -10,8 +10,7 @@
         android:layout_height="match_parent"
         android:paddingLeft="@dimen/activity_padding_side"
         android:paddingRight="@dimen/activity_padding_side"
-        android:orientation="vertical"
-        android:background="@color/dialog_bg_color">
+        android:orientation="vertical">
         <TableLayout xmlns:android="http://schemas.android.com/apk/res/android"
             android:layout_width="match_parent"
             android:layout_height="wrap_content">
@@ -133,14 +132,30 @@
                     android:layout_weight="0.5"/>
             </TableRow>-->
         </TableLayout>
-        <Button
-            android:id="@+id/dialog_add_milk_add_b"
-            android:layout_width="wrap_content"
+        <LinearLayout
+            android:layout_width="match_parent"
             android:layout_height="@dimen/normal_button_layout_height"
-            android:layout_gravity="right"
-            android:layout_marginTop="@dimen/activity_f_r_text_view_margin_top"
-            android:paddingLeft="@dimen/normal_button_padding_side"
-            android:paddingRight="@dimen/normal_button_padding_side"/>
+            android:orientation="horizontal"
+            android:layout_marginTop="40dp"
+            android:layout_gravity="bottom">
+            <Button
+                android:id="@+id/cancel_b"
+                android:layout_width="wrap_content"
+                android:layout_height="@dimen/normal_button_layout_height"
+                android:paddingLeft="@dimen/normal_button_padding_side"
+                android:paddingRight="@dimen/normal_button_padding_side"
+                android:textSize="@dimen/normal_text_size"
+                android:layout_weight="1"/>
+            <Button
+                android:id="@+id/dialog_add_milk_add_b"
+                android:layout_width="wrap_content"
+                android:layout_height="@dimen/normal_button_layout_height"
+                android:paddingLeft="@dimen/normal_button_padding_side"
+                android:paddingRight="@dimen/normal_button_padding_side"
+                android:textSize="@dimen/normal_text_size"
+                android:layout_weight="1"/>
+        </LinearLayout>
+
     </LinearLayout>
 
 </ScrollView>
diff --git a/MistroFarmer/src/main/res/layout/activity_events.xml b/MistroFarmer/src/main/res/layout/activity_events.xml
index 4857c98..a5ec9cf 100644
--- a/MistroFarmer/src/main/res/layout/activity_events.xml
+++ b/MistroFarmer/src/main/res/layout/activity_events.xml
@@ -19,5 +19,12 @@
             android:layout_width="match_parent"
             android:layout_height="@dimen/normal_button_layout_height"
             android:layout_marginTop="40dp"/>
+    <Button
+        android:id="@+id/back_b"
+        android:layout_width="@dimen/back_button_width"
+        android:layout_height="50dp"
+        android:layout_marginTop="90dp"
+        android:paddingLeft="15dp"
+        android:paddingRight="15dp"/>
 
 </LinearLayout>
diff --git a/MistroFarmer/src/main/res/layout/activity_fertility.xml b/MistroFarmer/src/main/res/layout/activity_fertility.xml
index 4565467..fe37042 100644
--- a/MistroFarmer/src/main/res/layout/activity_fertility.xml
+++ b/MistroFarmer/src/main/res/layout/activity_fertility.xml
@@ -19,6 +19,12 @@
         android:layout_width="match_parent"
         android:layout_height="@dimen/normal_button_layout_height"
         android:layout_marginTop="40dp"/>
-
+    <Button
+        android:id="@+id/back_b"
+        android:layout_width="@dimen/back_button_width"
+        android:layout_height="50dp"
+        android:layout_marginTop="90dp"
+        android:paddingLeft="15dp"
+        android:paddingRight="15dp"/>
 
 </LinearLayout>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/layout/activity_main_menu.xml b/MistroFarmer/src/main/res/layout/activity_main_menu.xml
index d89cea0..abe1e23 100644
--- a/MistroFarmer/src/main/res/layout/activity_main_menu.xml
+++ b/MistroFarmer/src/main/res/layout/activity_main_menu.xml
@@ -29,4 +29,11 @@
             android:layout_marginTop="30dp"
             android:paddingLeft="@dimen/normal_button_padding_side"
             android:paddingRight="@dimen/normal_button_padding_side"/>
+    <Button
+        android:id="@+id/logout_b"
+        android:layout_width="@dimen/back_button_width"
+        android:layout_height="50dp"
+        android:layout_marginTop="90dp"
+        android:paddingLeft="15dp"
+        android:paddingRight="15dp"/>
 </LinearLayout>
diff --git a/MistroFarmer/src/main/res/layout/activity_milk_production.xml b/MistroFarmer/src/main/res/layout/activity_milk_production.xml
index c312b14..0492d19 100644
--- a/MistroFarmer/src/main/res/layout/activity_milk_production.xml
+++ b/MistroFarmer/src/main/res/layout/activity_milk_production.xml
@@ -19,6 +19,12 @@
         android:layout_width="match_parent"
         android:layout_height="@dimen/normal_button_layout_height"
         android:layout_marginTop="40dp"/>
-
+    <Button
+        android:id="@+id/back_b"
+        android:layout_width="@dimen/back_button_width"
+        android:layout_height="50dp"
+        android:layout_marginTop="90dp"
+        android:paddingLeft="15dp"
+        android:paddingRight="15dp"/>
 
 </LinearLayout>
diff --git a/MistroFarmer/src/main/res/menu/add_event.xml b/MistroFarmer/src/main/res/menu/add_event.xml
index 0586185..0dc2157 100644
--- a/MistroFarmer/src/main/res/menu/add_event.xml
+++ b/MistroFarmer/src/main/res/menu/add_event.xml
@@ -7,4 +7,7 @@
           android:title="@string/swahili"
           android:orderInCategory="2"
           android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/add_milk_production.xml b/MistroFarmer/src/main/res/menu/add_milk_production.xml
index 3825362..07afa94 100644
--- a/MistroFarmer/src/main/res/menu/add_milk_production.xml
+++ b/MistroFarmer/src/main/res/menu/add_milk_production.xml
@@ -7,4 +7,7 @@
         android:title="@string/swahili"
         android:orderInCategory="2"
         android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/events.xml b/MistroFarmer/src/main/res/menu/events.xml
index 0586185..0dc2157 100644
--- a/MistroFarmer/src/main/res/menu/events.xml
+++ b/MistroFarmer/src/main/res/menu/events.xml
@@ -7,4 +7,7 @@
           android:title="@string/swahili"
           android:orderInCategory="2"
           android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/events_history.xml b/MistroFarmer/src/main/res/menu/events_history.xml
index 0586185..42c64a9 100644
--- a/MistroFarmer/src/main/res/menu/events_history.xml
+++ b/MistroFarmer/src/main/res/menu/events_history.xml
@@ -7,4 +7,7 @@
           android:title="@string/swahili"
           android:orderInCategory="2"
           android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="ifRoom" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/fertility.xml b/MistroFarmer/src/main/res/menu/fertility.xml
index f3b10b6..07afa94 100644
--- a/MistroFarmer/src/main/res/menu/fertility.xml
+++ b/MistroFarmer/src/main/res/menu/fertility.xml
@@ -1,6 +1,13 @@
 <menu xmlns:android="http://schemas.android.com/apk/res/android">
-    <item android:id="@+id/action_settings"
-        android:title="@string/action_settings"
-        android:orderInCategory="100"
+    <item android:id="@+id/action_english"
+        android:title="@string/english"
+        android:orderInCategory="1"
         android:showAsAction="never" />
-</menu>
+    <item android:id="@+id/action_swahili"
+        android:title="@string/swahili"
+        android:orderInCategory="2"
+        android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
+</menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/milk_procution_history.xml b/MistroFarmer/src/main/res/menu/milk_procution_history.xml
index 0586185..0dc2157 100644
--- a/MistroFarmer/src/main/res/menu/milk_procution_history.xml
+++ b/MistroFarmer/src/main/res/menu/milk_procution_history.xml
@@ -7,4 +7,7 @@
           android:title="@string/swahili"
           android:orderInCategory="2"
           android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/menu/milk_production.xml b/MistroFarmer/src/main/res/menu/milk_production.xml
index 0586185..0dc2157 100644
--- a/MistroFarmer/src/main/res/menu/milk_production.xml
+++ b/MistroFarmer/src/main/res/menu/milk_production.xml
@@ -7,4 +7,7 @@
           android:title="@string/swahili"
           android:orderInCategory="2"
           android:showAsAction="never" />
+    <item android:id="@+id/action_back_main_menu"
+        android:orderInCategory="3"
+        android:showAsAction="never" />
 </menu>
\ No newline at end of file
diff --git a/MistroFarmer/src/main/res/values/dimens.xml b/MistroFarmer/src/main/res/values/dimens.xml
index 24f1629..35deb02 100644
--- a/MistroFarmer/src/main/res/values/dimens.xml
+++ b/MistroFarmer/src/main/res/values/dimens.xml
@@ -14,4 +14,5 @@
     <dimen name="activity_f_r_text_view_margin_top">18dp</dimen>
     <dimen name="normal_button_layout_height">50dp</dimen>
     <dimen name="normal_button_padding_side">15dp</dimen>
+    <dimen name="back_button_width">100dp</dimen>
 </resources>
diff --git a/MistroFarmer/src/main/res/values/strings_en.xml b/MistroFarmer/src/main/res/values/strings_en.xml
index 451dff4..ab32d40 100644
--- a/MistroFarmer/src/main/res/values/strings_en.xml
+++ b/MistroFarmer/src/main/res/values/strings_en.xml
@@ -226,4 +226,7 @@
     <string name="no_service_en">Unable to send SMSs to the server because your device does not have a good enough network connection</string>
     <string name="radio_off_en">Your device is currently unable to send SMSs. Make sure it has a SIM card inserted and that it is not on Airplane mode</string>
     <string name="server_not_receive_sms_en">An SMS was sent to the server but it did not receive it</string>
+    <string name="logout_en">Logout</string>
+    <string name="back_en">Back</string>
+    <string name="back_to_main_menu_en">Back to Main Menu</string>
 </resources>
diff --git a/MistroFarmer/src/main/res/values/strings_sw.xml b/MistroFarmer/src/main/res/values/strings_sw.xml
index c75eec1..a583493 100644
--- a/MistroFarmer/src/main/res/values/strings_sw.xml
+++ b/MistroFarmer/src/main/res/values/strings_sw.xml
@@ -226,4 +226,7 @@
     <string name="no_service_sw">Nguvu ya signali ya simu yako haitoshi kutuma SMS</string>
     <string name="radio_off_sw">Hakikisha kwamba simu yako iko na kadi ya simu</string>
     <string name="server_not_receive_sms_sw">Simu yako imetuma SMS lakini mtandao haupokea ujumbe (SMS) huo</string>
+    <string name="logout_sw">Toka</string>
+    <string name="back_sw">Rudi</string>
+    <string name="back_to_main_menu_sw">Rudi kwa Menu Kuu</string>
 </resources>
-- 
2.7.1

