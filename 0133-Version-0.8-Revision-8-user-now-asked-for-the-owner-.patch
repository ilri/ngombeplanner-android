From 04075d19aded19a1721a6d9ab971946752fbc7c7 Mon Sep 17 00:00:00 2001
From: Jason Rogena <j.rogena@cgiar.org>
Date: Fri, 28 Mar 2014 07:50:44 +0300
Subject: [PATCH 133/213] Version 0.8 Revision 8: user now asked for the owner
 of a bull when adding servicing events

---
 MistroFarmer/src/main/AndroidManifest.xml          |  2 +-
 .../cgiar/ilri/mistro/farmer/AddEventActivity.java | 67 +++++++++++++++++++++-
 .../cgiar/ilri/mistro/farmer/LandingActivity.java  |  2 +-
 .../src/main/res/layout/activity_add_event.xml     | 32 +++++++++++
 MistroFarmer/src/main/res/values/strings_en.xml    |  8 +++
 MistroFarmer/src/main/res/values/strings_sw.xml    |  8 +++
 6 files changed, 116 insertions(+), 3 deletions(-)

diff --git a/MistroFarmer/src/main/AndroidManifest.xml b/MistroFarmer/src/main/AndroidManifest.xml
index 8881ff4..1d730b5 100644
--- a/MistroFarmer/src/main/AndroidManifest.xml
+++ b/MistroFarmer/src/main/AndroidManifest.xml
@@ -2,7 +2,7 @@
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
     package="org.cgiar.ilri.mistro.farmer"
     android:versionCode="2"
-    android:versionName="Version 0.8 Revision 7" >
+    android:versionName="0.8.8" >
 
     <uses-sdk
         android:minSdkVersion="7"
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
index f1b374b..8adf286 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/AddEventActivity.java
@@ -72,6 +72,11 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
     private EditText vetUsedET;
     private TextView bullNameTV;
     private AutoCompleteTextView bullNameACTV;
+    private TextView bullOwnerTV;
+    private Spinner bullOwnerS;
+    private TextView specBullOwnerTV;
+    private EditText specBullOwnerET;
+
     /*private TextView bullETNTV;
     private AutoCompleteTextView bullETNACTV;*/
     private TextView noOfServicingDaysTV;
@@ -124,6 +129,11 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         causeOfDeathS = (Spinner)findViewById(R.id.cause_of_death_s);
         bullNameTV = (TextView)findViewById(R.id.bull_name_tv);
         bullNameACTV = (AutoCompleteTextView)findViewById(R.id.bull_name_actv);
+        bullOwnerTV = (TextView)findViewById(R.id.bull_owner_tv);
+        bullOwnerS = (Spinner)findViewById(R.id.bull_owner_s);
+        bullOwnerS.setOnItemSelectedListener(this);
+        specBullOwnerTV = (TextView)findViewById(R.id.spec_bull_owner_tv);
+        specBullOwnerET = (EditText)findViewById(R.id.spec_bull_owner_et);
         /*bullETNTV = (TextView)findViewById(R.id.bull_etn_tv);
         bullETNACTV = (AutoCompleteTextView)findViewById(R.id.bull_etn_actv);*/
         noOfServicingDaysTV = (TextView)findViewById(R.id.no_of_servicing_days_tv);
@@ -209,6 +219,10 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
                 noOfServicingDaysET.setVisibility(EditText.GONE);
                 bullNameTV.setVisibility(TextView.VISIBLE);
                 bullNameACTV.setVisibility(AutoCompleteTextView.VISIBLE);
+                bullOwnerTV.setVisibility(TextView.VISIBLE);
+                bullOwnerS.setVisibility(Spinner.VISIBLE);
+                //specBullOwnerTV.setVisibility(TextView.VISIBLE);
+                //specBullOwnerET.setVisibility(EditText.VISIBLE);
                 /*bullETNTV.setVisibility(TextView.VISIBLE);
                 bullETNACTV.setVisibility(AutoCompleteTextView.VISIBLE);*/
                 remarksTV.setVisibility(TextView.GONE);
@@ -231,6 +245,10 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
                 eventTypeS.setVisibility(Spinner.GONE);
                 bullNameTV.setVisibility(TextView.GONE);
                 bullNameACTV.setVisibility(AutoCompleteTextView.GONE);
+                bullOwnerTV.setVisibility(TextView.GONE);
+                bullOwnerS.setVisibility(Spinner.GONE);
+                specBullOwnerTV.setVisibility(TextView.GONE);
+                specBullOwnerET.setVisibility(EditText.GONE);
                 /*bullETNTV.setVisibility(TextView.GONE);
                 bullETNACTV.setVisibility(AutoCompleteTextView.GONE);*/
                 remarksTV.setVisibility(TextView.GONE);
@@ -263,6 +281,18 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         }
         bullNameTV.setText(Locale.getStringInLocale("servicing_bull_name",this));
         bullNameACTV.setHint(Locale.getStringInLocale("servicing_bull_identifier_hint", this));
+        bullOwnerTV.setText(Locale.getStringInLocale("bull_owner", this));
+
+        int bullOwnersID = Locale.getArrayIDInLocale("bull_owners", this);
+        if(bullOwnersID != 0){
+            ArrayAdapter<CharSequence> bullOwnerArrayAdapter = ArrayAdapter.createFromResource(this, bullOwnersID, android.R.layout.simple_spinner_item);
+            bullOwnerArrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+            bullOwnerS.setAdapter(bullOwnerArrayAdapter);
+        }
+
+        specBullOwnerTV.setText(Locale.getStringInLocale("name_bull_owner", this));
+        specBullOwnerET.setHint(Locale.getStringInLocale("name_of_other_farmer_or_group", this));
+
         //bullETNTV.setText(Locale.getStringInLocale("servicing_bull_ear_tag_number",this));
         noOfServicingDaysTV.setText(Locale.getStringInLocale("no_of_days_in_servicing",this));
         remarksTV.setText(Locale.getStringInLocale("remarks",this));
@@ -317,6 +347,10 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         vetUsedET.setVisibility(EditText.GONE);
         bullNameTV.setVisibility(TextView.GONE);
         bullNameACTV.setVisibility(AutoCompleteTextView.GONE);
+        bullOwnerTV.setVisibility(TextView.GONE);
+        bullOwnerS.setVisibility(Spinner.GONE);
+        specBullOwnerTV.setVisibility(TextView.GONE);
+        specBullOwnerET.setVisibility(EditText.GONE);
         /*bullETNTV.setVisibility(TextView.GONE);
         bullETNACTV.setVisibility(AutoCompleteTextView.GONE);*/
         remarksTV.setVisibility(TextView.GONE);
@@ -370,6 +404,10 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
             dateTV.setText(Locale.getStringInLocale("date_served", this));
             bullNameTV.setVisibility(TextView.VISIBLE);
             bullNameACTV.setVisibility(AutoCompleteTextView.VISIBLE);
+            bullOwnerTV.setVisibility(TextView.VISIBLE);
+            bullOwnerS.setVisibility(Spinner.VISIBLE);
+            specBullOwnerTV.setVisibility(TextView.VISIBLE);
+            specBullOwnerET.setVisibility(EditText.VISIBLE);
             /*bullETNTV.setVisibility(TextView.VISIBLE);
             bullETNACTV.setVisibility(AutoCompleteTextView.VISIBLE);*/
             remarksTV.setVisibility(TextView.VISIBLE);
@@ -401,6 +439,17 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
         if(parent == eventTypeS) {
             eventTypeSelected();
         }
+        else if(parent == bullOwnerS){
+            String[] bullOwnersInEN = Locale.getArrayInLocale("bull_owners", this, Locale.LOCALE_ENGLISH);
+            if(bullOwnersInEN[bullOwnerS.getSelectedItemPosition()].equals("Own bull")){
+                specBullOwnerET.setVisibility(EditText.GONE);
+                specBullOwnerTV.setVisibility(TextView.GONE);
+            }
+            else{
+                specBullOwnerET.setVisibility(EditText.VISIBLE);
+                specBullOwnerTV.setVisibility(TextView.VISIBLE);
+            }
+        }
     }
 
     private void birthEventSelected() {
@@ -506,7 +555,23 @@ public class AddEventActivity extends SherlockActivity implements View.OnClickLi
                 jsonObject.put("strawNumber", strawNumberET.getText().toString());
                 jsonObject.put("vetUsed", vetUsedET.getText().toString());
                 //jsonObject.put("bullName", bullNameACTV.getText().toString());
-                jsonObject.put("bullEarTagNo", bullNameACTV.getText().toString());
+
+                //check if hint put as value of bullNameACTV
+                String bullEarTagNo = bullNameACTV.getText().toString();
+                if(bullEarTagNo.equals(Locale.getStringInLocale("servicing_bull_identifier_hint", AddEventActivity.this)))
+                    bullEarTagNo = "";
+                jsonObject.put("bullEarTagNo", bullEarTagNo);
+
+                if(selectedEvent.equals("Bull Servicing")){
+                    String[] bullOwnersInEN = Locale.getArrayInLocale("bull_owners", AddEventActivity.this, Locale.LOCALE_ENGLISH);
+                    jsonObject.put("bullOwner", bullOwnersInEN[bullOwnerS.getSelectedItemPosition()]);
+
+                    //check if hint put as value of EditText
+                    String bullOwnerName = specBullOwnerET.getText().toString();
+                    if(bullOwnerName.equals(Locale.getStringInLocale("name_of_other_farmer_or_group", AddEventActivity.this)))
+                        bullOwnerName = "";
+                    jsonObject.put("bullOwnerName", bullOwnerName);
+                }
                 //jsonObject.put("bullEarTagNo", bullETNACTV.getText().toString());
                 jsonObject.put("noOfServicingDays", noOfServicingDaysET.getText().toString());
                 if(servicingIDs != null) {
diff --git a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
index 19d8b01..7341121 100644
--- a/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
+++ b/MistroFarmer/src/main/java/org/cgiar/ilri/mistro/farmer/LandingActivity.java
@@ -77,7 +77,7 @@ public class LandingActivity extends SherlockActivity implements View.OnClickLis
 
         //init text according to locale
         initTextInViews();
-        Toast.makeText(this, "Version 0.8 Revision 3", Toast.LENGTH_LONG).show();
+        Toast.makeText(this, "Version 0.8 Revision 8", Toast.LENGTH_LONG).show();
     }
 
     public boolean onCreateOptionsMenu(Menu menu) {
diff --git a/MistroFarmer/src/main/res/layout/activity_add_event.xml b/MistroFarmer/src/main/res/layout/activity_add_event.xml
index 378f649..35e6b81 100644
--- a/MistroFarmer/src/main/res/layout/activity_add_event.xml
+++ b/MistroFarmer/src/main/res/layout/activity_add_event.xml
@@ -148,6 +148,38 @@
             android:textSize="@dimen/normal_text_size"
             android:visibility="gone"
             android:textColor="@color/text_input_color"/>
+        <TextView
+            android:id="@+id/bull_owner_tv"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="@dimen/activity_f_r_text_view_margin_top"
+            android:visibility="gone"
+            android:textSize="@dimen/normal_text_size"/>
+        <Spinner
+            android:id="@+id/bull_owner_s"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:textColor="@color/text_input_color"
+            android:layout_marginTop="@dimen/activity_f_r_edit_text_margin_top"
+            android:layout_marginLeft="@dimen/activity_f_r_edit_text_margin_left"
+            android:visibility="gone"/>
+        <TextView
+            android:id="@+id/spec_bull_owner_tv"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="@dimen/activity_f_r_text_view_margin_top"
+            android:visibility="gone"
+            android:textSize="@dimen/normal_text_size"/>
+        <EditText
+            android:id="@+id/spec_bull_owner_et"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="@dimen/activity_f_r_edit_text_margin_top"
+            android:layout_marginLeft="@dimen/activity_f_r_edit_text_margin_left"
+            android:textSize="@dimen/normal_text_size"
+            android:visibility="gone"
+            android:inputType="textCapWords|textPersonName"
+            android:textColor="@color/text_input_color"/>
         <!--<TextView
             android:id="@+id/bull_etn_tv"
             android:layout_width="wrap_content"
diff --git a/MistroFarmer/src/main/res/values/strings_en.xml b/MistroFarmer/src/main/res/values/strings_en.xml
index 5fdaef0..770954a 100644
--- a/MistroFarmer/src/main/res/values/strings_en.xml
+++ b/MistroFarmer/src/main/res/values/strings_en.xml
@@ -79,6 +79,14 @@
     <string name="servicing_bull_name_en">Bull used</string>
     <string name="servicing_bull_identifier_hint_en">Enter the name, ear tag number or ID of bull</string>
     <string name="servicing_bull_ear_tag_number_en">Ear tag number of the Bull used</string>
+    <string name="bull_owner_en">Who owns the bull?</string>
+    <string name="name_bull_owner_en">Name of bull owner</string>
+    <string-array name="bull_owners_en">
+        <item>Own bull</item>
+        <item>Another farmer</item>
+        <item>A group</item>
+    </string-array>
+    <string name="name_of_other_farmer_or_group_en">Enter the name of the farmer or group</string>
     <string name="embryo_number_en">Embryo Number</string>
     <string name="enable_gps_en">Enable GPS</string>
     <string name="reason_for_enabling_gps_en">You need to enable your GPS before you can continue. Press Okay to enable GPS</string>
diff --git a/MistroFarmer/src/main/res/values/strings_sw.xml b/MistroFarmer/src/main/res/values/strings_sw.xml
index a70cd43..7b2e98d 100644
--- a/MistroFarmer/src/main/res/values/strings_sw.xml
+++ b/MistroFarmer/src/main/res/values/strings_sw.xml
@@ -79,6 +79,14 @@
     <string name="servicing_bull_name_sw">Ndume aliyetumiwa</string>
     <string name="servicing_bull_identifier_hint_sw">Ingiza jina, namba ya sikio au kitambulisho (ID) ya ndume</string>
     <string name="servicing_bull_ear_tag_number_sw">Namba ya Sikio ya Ndume aliyetumiwa</string>
+    <string name="bull_owner_sw">Nani anamiliki ndume?</string>
+    <string name="name_bull_owner_sw">Jina ya mmiliki</string>
+    <string-array name="bull_owners_sw">
+        <item>Ndume ni yangu</item>
+        <item>Ndume ni ya mkulima mwingine</item>
+        <item>Ndume ni ya kundi</item>
+    </string-array>
+    <string name="name_of_other_farmer_or_group_sw">Ingiza jina ya mkulima au kundi</string>
     <string name="embryo_number_sw">Embryo Number</string>
     <string name="enable_gps_sw">Wezesha GPS</string>
     <string name="reason_for_enabling_gps_sw">Unahitaji kuwezesha GPS kabla ya kuendelea. Bonyeza \'Sawa\' ili kuwawezesha GPS</string>
-- 
2.7.1

