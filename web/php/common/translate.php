<?php
class Translator{
   public static $text_code = "text_code";
   public static $ABORTION = "ABORTION";
   public static $ACQ_INSTR = "ACQ_INSTR";
   public static $ACQ_NO_INSTR = "ACQ_NO_INSTR";
   public static $ADDING_MILK_RECORDS = "ADDING_MILK_RECORDS";
   public static $AFTERNOON = "AFTERNOON";
   public static $AI_INSTR = "AI_INSTR";
   public static $AMOUNT_KG = "AMOUNT_KG";
   public static $AMOUNT_LITRES = "AMOUNT_LITRES";
   public static $ARTIFICIAL_INSEMINATION = "ARTIFICIAL_INSEMINATION";
   public static $BULL_SERVICING = "BULL_SERVICING";
   public static $CALVING_INSTR = "CALVING_INSTR";
   public static $CANCEL = "CANCEL";
   public static $COMBINED = "COMBINED";
   public static $CONCENTRATES = "CONCENTRATES";
   public static $COWS_TOO_YOUNG = "COWS_TOO_YOUNG";
   public static $DEATH = "DEATH";
   public static $DEWORMING = "DEWORMING";
   public static $DIPPING_SPRAYING = "DIPPING_SPRAYING";
   public static $DISPOSAL_INSTR = "DISPOSAL_INSTR";
   public static $DOWRY = "DOWRY";
   public static $DRY_OFF = "DRY_OFF";
   public static $ENTER_NUMBER = "ENTER_NUMBER";
   public static $ERROR_OCCURRED = "ERROR_OCCURRED";
   public static $EVENING = "EVENING";
   public static $EVENT_RECORDS_MONTH = "EVENT_RECORDS_MONTH";
   public static $FORECAST_SENT_SMS = "FORECAST_SENT_SMS";
   public static $FORECAST_UNAVAILABLE = "FORECAST_UNAVAILABLE";
   public static $FRIDAY = "FRIDAY";
   public static $GIFT = "GIFT";
   public static $HAY = "HAY";
   public static $INDIVIDUAL_CUSTOMER = "INDIVIDUAL_CUSTOMER";
   public static $INFORMATION_PORTAL = "INFORMATION_PORTAL";
   public static $INFO_RECORDED = "INFO_RECORDED";
   public static $INFO_WILL_BE_SENT = "INFO_WILL_BE_SENT";
   public static $LEGUMES = "LEGUMES";
   public static $MILK_DATA_ALREADY_THERE = "MILK_DATA_ALREADY_THERE";
   public static $MILK_DATA_FOR_COW_ENTERED = "MILK_DATA_FOR_COW_ENTERED";
   public static $MILK_DATA_INCONSISTENT = "MILK_DATA_INCONSISTENT";
   public static $MILK_PROD_INSTR = "MILK_PROD_INSTR";
   public static $MILK_RECORDS_MONTH = "MILK_RECORDS_MONTH";
   public static $MILK_RECORDS_WEEK = "MILK_RECORDS_WEEK";
   public static $MILK_RECORDS_YDAY = "MILK_RECORDS_YDAY";
   public static $MINERAL_LICKS = "MINERAL_LICKS";
   public static $MONDAY = "MONDAY";
   public static $MONTH_EVENT_RECORDS = "MONTH_EVENT_RECORDS";
   public static $MONTH_MILK_RECORDS = "MONTH_MILK_RECORDS";
   public static $MORE = "MORE";
   public static $MORNING = "MORNING";
   public static $NAPIER = "NAPIER";
   public static $NATURAL_GRASS = "NATURAL_GRASS";
   public static $NORMAL = "NORMAL";
   public static $NOT_REGISTERED = "NOT_REGISTERED";
   public static $NO_COWS = "NO_COWS";
   public static $NO_COWS_AVAILABLE = "NO_COWS_AVAILABLE";
   public static $NO_MONTH_EVENT_RECORDS = "NO_MONTH_EVENT_RECORDS";
   public static $NO_MONTH_MILK_RECORDS = "NO_MONTH_MILK_RECORDS";
   public static $NO_WEEK_MILK_RECORDS = "NO_WEEK_MILK_RECORDS";
   public static $NO_YDAY_MILK_RECORDS = "NO_YDAY_MILK_RECORDS";
   public static $NUMBER_CHANGED = "NUMBER_CHANGED";
   public static $NUMBER_GT_ZERO = "NUMBER_GT_ZERO";
   public static $NUMBER_NOT_EXIST = "NUMBER_NOT_EXIST";
   public static $OKAY = "OKAY";
   public static $PLEASE_REDIAL = "PLEASE_REDIAL";
   public static $PREMATURE = "PREMATURE";
   public static $PRESS_10_MILK_RESERVED = "PRESS_10_MILK_RESERVED";
   public static $PRESS_11_MILK_SOLD = "PRESS_11_MILK_SOLD";
   public static $PRESS_1_MILK_DATA = "PRESS_1_MILK_DATA";
   public static $PRESS_2_FEEDING = "PRESS_2_FEEDING";
   public static $PRESS_2_SICKNESS = "PRESS_2_SICKNESS";
   public static $PRESS_3_REP = "PRESS_3_REP";
   public static $PRESS_3_SOH = "PRESS_3_SOH";
   public static $PRESS_3_WATER = "PRESS_3_WATER";
   public static $PRESS_4_INFO_PORTAL = "PRESS_4_INFO_PORTAL";
   public static $PRESS_4_INSEMINATION = "PRESS_4_INSEMINATION";
   public static $PRESS_4_RECORDS = "PRESS_4_RECORDS";
   public static $PRESS_4_SERVICING = "PRESS_4_SERVICING";
   public static $PRESS_5_CALVING = "PRESS_5_CALVING";
   public static $PRESS_5_EVENTS = "PRESS_5_EVENTS";
   public static $PRESS_6_DEATH = "PRESS_6_DEATH";
   public static $PRESS_6_P_MEASURES = "PRESS_6_P_MEASURES";
   public static $PRESS_6_VACCINATION = "PRESS_6_VACCINATION";
   public static $PRESS_7_ACQ = "PRESS_7_ACQ";
   public static $PRESS_7_SICKNESS = "PRESS_7_SICKNESS";
   public static $PRESS_8_DISPOSAL = "PRESS_8_DISPOSAL";
   public static $PRESS_8_EXIT = "PRESS_8_EXIT";
   public static $PRESS_9_MILK_CONSUMED = "PRESS_9_MILK_CONSUMED";
   public static $PRESS_9_WEATHER = "PRESS_9_WEATHER";
   public static $PREVIOUS = "PREVIOUS";
   public static $PRICE_PER_LITER = "PRICE_PER_LITER";
   public static $PRIVATE_MILK_TRADER = "PRIVATE_MILK_TRADER";
   public static $PROCESSOR = "PROCESSOR";
   public static $PURCHASE = "PURCHASE";
   public static $RECORDING_CALVING = "RECORDING_CALVING";
   public static $RECORDING_DEATH = "RECORDING_DEATH";
   public static $RECORDING_DISPOSAL = "RECORDING_DISPOSAL";
   public static $RECORDING_DRY_OFF = "RECORDING_DRY_OFF";
   public static $RECORDING_FEEDING = "RECORDING_FEEDING";
   public static $RECORDING_MILK_CONSUMED = "RECORDING_MILK_CONSUMED";
   public static $RECORDING_MILK_RESERVED = "RECORDING_MILK_RESERVED";
   public static $RECORDING_MILK_SOLD_CATEGORY = "RECORDING_MILK_SOLD_CATEGORY";
   public static $RECORDING_MILK_SOLD_LITERS_REJECTED = "RECORDING_MILK_SOLD_LITERS_REJECTED";
   public static $RECORDING_MILK_SOLD_LITERS_SOLD = "RECORDING_MILK_SOLD_LITERS_SOLD";
   public static $RECORDING_MILK_SOLD_TIME = "RECORDING_MILK_SOLD_TIME";
   public static $RECORDING_PREG_CONF = "RECORDING_PREG_CONF";
   public static $RECORDING_SERVICING = "RECORDING_SERVICING";
   public static $RECORDING_SICKNESS = "RECORDING_SICKNESS";
   public static $RECORDING_SOH = "RECORDING_SOH";
   public static $RECORDING_START_OF_LACT = "RECORDING_START_OF_LACT";
   public static $RECORDING_VACCINATION = "RECORDING_VACCINATION";
   public static $RECORDING_WATER = "RECORDING_WATER";
   public static $RECORD_CALVING = "RECORD_CALVING";
   public static $RECORD_MILK_REJECTED = "RECORD_MILK_REJECTED";
   public static $RECORD_MILK_SALE = "RECORD_MILK_SALE";
   public static $RECORD_MILK_SALE_CATEGORY = "RECORD_MILK_SALE_CATEGORY";
   public static $RECORD_MILK_SOLD = "RECORD_MILK_SOLD";
   public static $RECORD_PREG_CONF = "RECORD_PREG_CONF";
   public static $RECORD_SALE_PRICE_PER_LITER = "RECORD_SALE_PRICE_PER_LITER";
   public static $RECORD_SERVICING = "RECORD_SERVICING";
   public static $RECORD_SOH = "RECORD_SOH";
   public static $RECORD_TRANSPORT_COST = "RECORD_TRANSPORT_COST";
   public static $SALE = "SALE";
   public static $SATURDAY = "SATURDAY";
   public static $SELECT_BUYER = "SELECT_BUYER";
   public static $SELECT_SERVICE_TYPE = "SELECT_SERVICE_TYPE";
   public static $SELECT_VALID_OPTION = "SELECT_VALID_OPTION";
   public static $SERVICING_INSTR = "SERVICING_INSTR";
   public static $SILAGE = "SILAGE";
   public static $SOMETHING_WRONG_NGOMBE_PLANNER = "SOMETHING_WRONG_NGOMBE_PLANNER";
   public static $START_OF_LACT = "START_OF_LACT";
   public static $STILL = "STILL";
   public static $SUNDAY = "SUNDAY";
   public static $THURSDAY = "THURSDAY";
   public static $TODAY = "TODAY";
   public static $TOMORROW = "TOMORROW";
   public static $TO_GO_BACK = "TO_GO_BACK";
   public static $TUESDAY = "TUESDAY";
   public static $UNABLE_GET_SELECTED_COW = "UNABLE_GET_SELECTED_COW";
   public static $UNKNOWN_OPTION_SELECTED = "UNKNOWN_OPTION_SELECTED";
   public static $VACCINATION = "VACCINATION";
   public static $WEATHER_FORECAST = "WEATHER_FORECAST";
   public static $WEDNESDAY = "WEDNESDAY";
   public static $WEEK_MILK_RECORDS = "WEEK_MILK_RECORDS";
   public static $WELCOME = "WELCOME";
   public static $WRONG_FORMAT_COW_DATA = "WRONG_FORMAT_COW_DATA";
   public static $WRONG_OPTION_SELECTED = "WRONG_OPTION_SELECTED";
   public static $YDAY_MILK_RECORDS = "YDAY_MILK_RECORDS";
   public static $Y_AFTERNOON = "Y_AFTERNOON";
   public static $Y_COMBINED = "Y_COMBINED";
   public static $Y_EVENING = "Y_EVENING";
   public static $Y_MORNING = "Y_MORNING";
   public static $MILKING_TIME_INSTRUCTIONS = "MILKING_TIME_INSTRUCTIONS";
   public static $EADD_HUB = "EADD_HUB";
   public static $FEEDING_TIME_INSTRUCTIONS = "FEEDING_TIME_INSTRUCTIONS";
   public static $FEEDING_QUANTITY_INSTRUCTIONS = "FEEDING_QUANTITY_INSTRUCTIONS";
   public static $FEEDING_TYPE_INSTRUCTIONS = "FEEDING_TYPE_INSTRUCTIONS";
   public static $YESTERDAY = "YESTERDAY";
   public static $WATER_TIME_INSTRUCTIONS = "WATER_TIME_INSTRUCTIONS";
   public static $WATER_QUANTITY_INSTRUCTIONS = "WATER_QUANTITY_INSTRUCTIONS";
   public static $MILK_DATA = "MILK_DATA";
   public static $FEEDING = "FEEDING";
   public static $WATER = "WATER";
   public static $INSEMINATION = "INSEMINATION";
   public static $CALVING = "CALVING";
   public static $SICKNESS = "SICKNESS";
   public static $EXIT = "EXIT";
   public static $MILK_CONSUMED = "MILK_CONSUMED";
   public static $MILK_RESERVED = "MILK_RESERVED";
   public static $MILK_SOLD = "MILK_SOLD";
   public static $SERVICING_COST_INSTRUCTIONS = "SERVICING_COST_INSTRUCTIONS";
   public static $SERVICING_INSTRUCTIONS = "SERVICING_INSTRUCTIONS";
   public static $INSEMINATION_RESULTS_INSTRUCTIONS = "INSEMINATION_RESULTS_INSTRUCTIONS";
   public static $INSEMINATION_RESULTS_TYPE_INSTRUCTIONS = "INSEMINATION_RESULTS_TYPE_INSTRUCTIONS";
   public static $INSEMINATION_RESULTS = "INSEMINATION_RESULTS";
   public static $YES = "YES";
   public static $NO = "NO";
   public static $THROUGHOUT_DAY = "THROUGHOUT_DAY";
   public static $TWICE_OR_MORE = "TWICE_OR_MORE";
   public static $ONCE = "ONCE";
   public static $NOT_PROVIDED = "NOT_PROVIDED";
   public static $WATER_TYPE_INSTRUCTIONS = "WATER_TYPE_INSTRUCTIONS";
   public static $FEEDING_INSTRUCTIONS = "FEEDING_INSTRUCTIONS";
   public static $FEEDING_COW_INSTRUCTIONS = "FEEDING_COW_INSTRUCTIONS";
   public static $RECORD_MILK_SOLD_TD = "RECORD_MILK_SOLD_TD";
   public static $RECORD_MILK_SALE_CATEGORY_TD = "RECORD_MILK_SALE_CATEGORY_TD";
   public static $RECORD_SALE_PRICE_PER_LITER_TD = "RECORD_SALE_PRICE_PER_LITER_TD";
   public static $RECORD_MILK_REJECTED_TD = "RECORD_MILK_REJECTED_TD";
   public static $PROBLEMATIC_FULL_TERM = "PROBLEMATIC_FULL_TERM";
   public static $NATURAL = "NATURAL";
   public static $INJURY = "INJURY";
   public static $CAUSE_OF_DEATH_INSTRUCTIONS = "CAUSE_OF_DEATH_INSTRUCTIONS";
   public static $COW_COST_INSTRUCTIONS = "COW_COST_INSTRUCTIONS";
   
   private $TAG = "Translator";
   private $locale;
   private $logHandler;
   private $database;
   
   public function __construct($logHandler, $database, $locale = -1){
      $this->logHandler = $logHandler;
      $this->locale = $locale;
      $this->database = $database;
      
      $this->logHandler->log(3, $this->TAG, "Initialized translator");
   }
   
   public function isLocaleSet(){
      if($this->locale == -1){
         return false;
      }
      return true;
   }
   
   public function getLocale(){
      $locale = $this->locale;
      if($locale == -1){
         $this->logHandler->log(2, $this->TAG, "Locale not set, defaulting to english");
         $locale = "en";
      }
      return $locale;
   }

   public function setLocale($phoneNumber){
      $query = "SELECT pref_locale FROM farmer WHERE mobile_no LIKE '%{$phoneNumber}' or mobile_no2 LIKE '%{$phoneNumber}'";
      $result = $this->database->runMySQLQuery($query, true);
      if(is_array($result) && $result[0]['pref_locale'] != null && strlen($result[0]['pref_locale']) > 0){
         $this->logHandler->log(3, $this->TAG, "Setting the locale for " . $phoneNumber . " = ".$result[0]['pref_locale']);
         $this->locale = $result[0]['pref_locale'];
      }
      else{
         $this->logHandler->log(2, $this->TAG, "No prefered locale found for " . $phoneNumber . ". Defaulting to english");
         $this->locale = "en";
      }
   }
   
   /*public function getText($textContainer, $locale = -1){
      if($locale == -1)
         $locale = $this->locale;
      
      if($locale != -1){
         $translatedText = $textContainer[$locale];
         $this->logHandler->log(4, $this->TAG, "Translated text to " . $translatedText);//switch to debug
         return $translatedText;
      }
      else{
         $defaultText = $this->getText($textContainer, "en");
         $this->logHandler->log(2,  $this->TAG, "No prefered locale provided for ".print_r($textContainer, true).". Returning ".$defaultText);
         return $defaultText;
      }
   }*/
   public function getText($textCode, $locale = -1){
      if($locale == -1)
         $locale = $this->locale;
      
      if($locale != -1){//user does not have a preferred locale
         $query = "select locale_string from translated_text where text_code = '$textCode' and locale = '$locale'";
      }
      else{
         $query = "select locale_string from translated_text where text_code = '$textCode' and locale = 'en'";
         $this->logHandler->log(2, $this->TAG, "No prefered locale provided for ".print_r($textCode, true).". Returning translation from default locale");
      }
      $result = $this->database->runMySQLQuery($query, true);
      if(is_array($result) && count($result) == 1) {
         return $result[0]['locale_string'];
      }
      $this->logHandler->log(1, $this->TAG, "No translated text found for '$textCode' in '$locale'. Returning NULL");
      return null;
   }
}
?>
