From 4f068b0339cd9b94922f8e45124d9a1d49430437 Mon Sep 17 00:00:00 2001
From: Jason Rogena <jasonrogena@gmail.com>
Date: Thu, 31 Oct 2013 12:10:56 +0300
Subject: [PATCH 100/213] login logic/backend implemented for javaME

---
 .../org/cgiar/ilri/mistro/farmer/carrier/Cow.java  |  27 +
 .../cgiar/ilri/mistro/farmer/carrier/Farmer.java   |  22 +
 .../mistro/farmer/ui/AddMilkProductionScreen.java  |   2 +-
 .../cgiar/ilri/mistro/farmer/ui/LoginScreen.java   |  93 ++-
 .../ilri/mistro/farmer/ui/MainMenuScreen.java      |   7 +-
 .../mistro/farmer/ui/MilkProductionScreen.java     |   7 +-
 web/log/debug.log                                  | 693 +++++++++++++++++++++
 web/log/info.log                                   |  66 ++
 web/log/warning.log                                |   6 +
 web/php/farmer/authentication.php                  |  47 +-
 10 files changed, 950 insertions(+), 20 deletions(-)

diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Cow.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Cow.java
index 0dfffe5..ff4ab7a 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Cow.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Cow.java
@@ -59,6 +59,33 @@ public class Cow {
         otherDeformity = "";
         piggyBack = "";
     }
+    
+    public Cow(JSONObject cowJSONObject){
+        try {
+            name = cowJSONObject.getString("name");
+            earTagNumber = cowJSONObject.getString("ear_tag_number");;
+            dateOfBirth = cowJSONObject.getString("date_of_birth");;
+            age = cowJSONObject.getInt("age");
+            ageType = cowJSONObject.getString("age_type");;
+            breeds = new String[0];
+            sex = cowJSONObject.getString("sex");
+            deformities = new String[0];
+            this.isNotDamOrSire = true;
+            if (isNotDamOrSire)//LOL, brings StackOverflowError if you init sire object inside sire object
+            {
+                sire = new Sire();
+                dam = new Dam();
+            }
+            mode = "";
+            countryOfOrigin = "";
+            serviceType = cowJSONObject.getString("service_type");
+            otherDeformity = "";
+            piggyBack = "";
+        } 
+        catch (JSONException ex) {
+            ex.printStackTrace();
+        }
+    }
 
     public void setMode(String mode) {
         this.mode = mode;
diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Farmer.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Farmer.java
index 41bcedf..d037833 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Farmer.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/carrier/Farmer.java
@@ -32,6 +32,28 @@ public class Farmer {
         simCardSN ="";
         mode = "";
     }
+    
+    public Farmer(JSONObject farmerJSONObject){
+        try {
+            fullName = farmerJSONObject.getString("name");
+            extensionPersonnel="";
+            mobileNumber=farmerJSONObject.getString("mobile_no");
+            longitude=farmerJSONObject.getString("gps_longitude");
+            latitude=farmerJSONObject.getString("gps_latitude");
+            simCardSN=farmerJSONObject.getString("sim_card_sn");
+            
+            JSONArray cowsJSONArray = farmerJSONObject.getJSONArray("cows");
+            cows = new Cow[cowsJSONArray.length()];
+            for(int i=0; i < cows.length; i++){
+                cows[i] = new Cow(cowsJSONArray.getJSONObject(i));
+            }
+            
+            mode = "";
+        } 
+        catch (JSONException ex) {
+            ex.printStackTrace();
+        }
+    }
 
     public void setFullName(String fullName) {
         this.fullName = fullName;
diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/AddMilkProductionScreen.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/AddMilkProductionScreen.java
index f70b697..d705a05 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/AddMilkProductionScreen.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/AddMilkProductionScreen.java
@@ -65,7 +65,7 @@ public class AddMilkProductionScreen extends Form implements Screen{
 
             public void actionPerformed(ActionEvent evt) {
                 if(evt.getCommand().equals(backCommand)) {
-                    MilkProductionScreen milkProductionScreen = new MilkProductionScreen(AddMilkProductionScreen.this.midlet, AddMilkProductionScreen.this.locale);
+                    MilkProductionScreen milkProductionScreen = new MilkProductionScreen(AddMilkProductionScreen.this.midlet, AddMilkProductionScreen.this.locale, AddMilkProductionScreen.this.farmer);
                     milkProductionScreen.start();
                 }
                 else if(evt.getCommand().equals(addCommand)){
diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/LoginScreen.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/LoginScreen.java
index 288f5ed..ab8bd89 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/LoginScreen.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/LoginScreen.java
@@ -3,13 +3,20 @@ package org.cgiar.ilri.mistro.farmer.ui;
 import com.sun.lwuit.Button;
 import com.sun.lwuit.Command;
 import com.sun.lwuit.Component;
+import com.sun.lwuit.Dialog;
 import com.sun.lwuit.Form;
+import com.sun.lwuit.Label;
+import com.sun.lwuit.TextField;
 import com.sun.lwuit.events.ActionEvent;
 import com.sun.lwuit.events.ActionListener;
 import com.sun.lwuit.layouts.BoxLayout;
 import org.cgiar.ilri.mistro.farmer.Midlet;
+import org.cgiar.ilri.mistro.farmer.carrier.Farmer;
 import org.cgiar.ilri.mistro.farmer.ui.localization.Locale;
 import org.cgiar.ilri.mistro.farmer.ui.localization.StringResources;
+import org.cgiar.ilri.mistro.farmer.utils.DataHandler;
+import org.json.me.JSONException;
+import org.json.me.JSONObject;
 
 
 /**
@@ -80,9 +87,91 @@ public class LoginScreen extends Form implements Screen, ActionListener{
             farmerRegistrationScreen.start();
         }
         else if(event.getComponent().equals(loginButton)){
-            MainMenuScreen mainMenuScreen = new MainMenuScreen(midlet, locale);
-            mainMenuScreen.start();
+            final Dialog infoDialog = new Dialog(Locale.getStringInLocale(locale, StringResources.login));
+            infoDialog.setDialogType(Dialog.TYPE_INFO);
+            
+            final Command cancelCommand = new Command(Locale.getStringInLocale(locale, StringResources.cancel));
+            infoDialog.addCommand(cancelCommand);
+            
+            final Command loginCommand = new Command(Locale.getStringInLocale(locale, StringResources.login));
+            infoDialog.addCommand(loginCommand);
+            
+            Label mobileNumberL = new Label(Locale.getStringInLocale(locale, StringResources.mobile_number));
+            mobileNumberL.getStyle().setMargin(10, 0, 10, 0);
+            mobileNumberL.getSelectedStyle().setMargin(10, 0, 10, 0);
+            infoDialog.addComponent(mobileNumberL);
+            
+            final TextField mobileNumberTF = new TextField();
+            mobileNumberTF.getStyle().setMargin(5, 0, 0, 0);
+            mobileNumberTF.getSelectedStyle().setMargin(5, 0, 0, 0);
+            mobileNumberTF.setConstraint(TextField.NUMERIC);
+            mobileNumberTF.setInputModeOrder(new String[] {"123"});
+            infoDialog.addComponent(mobileNumberTF);
+            
+            infoDialog.addCommandListener(new ActionListener() {
+                public void actionPerformed(ActionEvent evt) {
+                    if(evt.getCommand().equals(cancelCommand)){
+                        infoDialog.dispose();
+                    }
+                    else if(evt.getCommand().equals(loginCommand)){
+                        if(mobileNumberTF.getText()!=null || mobileNumberTF.getText().trim().length()>0){
+                            String mobileNumber = mobileNumberTF.getText();
+                            Thread thread = new Thread(new LoginHandler(mobileNumber, infoDialog));
+                            thread.run();
+                        }
+                    }
+                }
+            });
+            
+            infoDialog.show(100, 100, 11, 11, true);
+        }
+    }
+    
+    private void actOnServerResponse(String response){
+        if(response == null){
+            System.err.println("no response from server");
+        }
+        else if(response.equals(DataHandler.CODE_USER_NOT_AUTHENTICATED)) {
+            System.err.println("user not authenticated");
+        }
+        else{
+            try {
+                JSONObject farmerJSONObject = new JSONObject(response);
+                Farmer farmer = new Farmer(farmerJSONObject);
+                
+                MainMenuScreen mainMenuScreen = new MainMenuScreen(midlet, locale, farmer);
+                mainMenuScreen.start();
+            }
+            catch (JSONException ex) {
+                ex.printStackTrace();
+            }
+        }
+    }
+    
+    private class LoginHandler implements Runnable{
+        
+        String mobileNumber;
+        Dialog parentDialog;
+
+        public LoginHandler(String mobileNumber, Dialog parentDialog) {
+            this.mobileNumber = mobileNumber;
+            this.parentDialog = parentDialog;
         }
+        
+
+        public void run() {
+            JSONObject jSONObject = new JSONObject();
+            try {
+                jSONObject.put("mobileNumber", mobileNumber);
+                String response = DataHandler.sendDataToServer(jSONObject, DataHandler.FARMER_AUTHENTICATION_URL);
+                parentDialog.dispose();
+                actOnServerResponse(response);
+            } 
+            catch (JSONException ex) {
+                ex.printStackTrace();
+            }
+        }
+        
     }
     
 }
diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MainMenuScreen.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MainMenuScreen.java
index ff8b1b7..9e19779 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MainMenuScreen.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MainMenuScreen.java
@@ -14,6 +14,7 @@ import com.sun.lwuit.events.ActionEvent;
 import com.sun.lwuit.events.ActionListener;
 import com.sun.lwuit.layouts.BoxLayout;
 import org.cgiar.ilri.mistro.farmer.Midlet;
+import org.cgiar.ilri.mistro.farmer.carrier.Farmer;
 import org.cgiar.ilri.mistro.farmer.ui.localization.Locale;
 import org.cgiar.ilri.mistro.farmer.ui.localization.StringResources;
 
@@ -25,17 +26,19 @@ public class MainMenuScreen extends Form implements Screen, ActionListener{
 
     private final int locale;
     private final Midlet midlet;
+    private final Farmer farmer;
     
     private Command backCommand;
     private Button milkProductionB;
     private Button eventsB;
     private BoxLayout parentBoxLayout;
     
-    public MainMenuScreen(Midlet midlet, int locale) {
+    public MainMenuScreen(Midlet midlet, int locale, Farmer farmer) {
         super(Locale.getStringInLocale(locale, StringResources.main_menu));
         
         this.locale = locale;
         this.midlet = midlet;
+        this.farmer = farmer;
         
         this.parentBoxLayout = new BoxLayout(BoxLayout.Y_AXIS);
         this.setLayout(parentBoxLayout);
@@ -87,7 +90,7 @@ public class MainMenuScreen extends Form implements Screen, ActionListener{
 
     public void actionPerformed(ActionEvent evt) {
         if(evt.getComponent().equals(milkProductionB)){
-            MilkProductionScreen milkProductionScreen = new MilkProductionScreen(midlet, locale);
+            MilkProductionScreen milkProductionScreen = new MilkProductionScreen(midlet, locale,farmer);
             milkProductionScreen.start();
         }
     }
diff --git a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MilkProductionScreen.java b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MilkProductionScreen.java
index 16445c3..9740f09 100644
--- a/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MilkProductionScreen.java
+++ b/JavaME/MistroFarmer/MistroFarmer/src/org/cgiar/ilri/mistro/farmer/ui/MilkProductionScreen.java
@@ -6,6 +6,7 @@ import com.sun.lwuit.events.ActionEvent;
 import com.sun.lwuit.events.ActionListener;
 import com.sun.lwuit.layouts.BoxLayout;
 import org.cgiar.ilri.mistro.farmer.Midlet;
+import org.cgiar.ilri.mistro.farmer.carrier.Farmer;
 import org.cgiar.ilri.mistro.farmer.ui.localization.Locale;
 import org.cgiar.ilri.mistro.farmer.ui.localization.StringResources;
 
@@ -17,14 +18,16 @@ public class MilkProductionScreen extends Form implements Screen, ActionListener
 
     private final int locale;
     private final Midlet midlet;
+    private final Farmer farmer;
     
     private BoxLayout parentBoxLayout;
     private Command backCommand;
     
-    public MilkProductionScreen(Midlet midlet, int locale) {
+    public MilkProductionScreen(Midlet midlet, int locale, Farmer farmer) {
         super(Locale.getStringInLocale(locale, StringResources.milk_production));
         this.midlet = midlet;
         this.locale = locale;
+        this.farmer = farmer;
         
         this.parentBoxLayout = new BoxLayout(BoxLayout.Y_AXIS);
         this.setLayout(parentBoxLayout);
@@ -36,7 +39,7 @@ public class MilkProductionScreen extends Form implements Screen, ActionListener
 
             public void actionPerformed(ActionEvent evt) {
                 if(evt.getCommand().equals(backCommand)) {
-                    MainMenuScreen mainMenuScreen = new MainMenuScreen(MilkProductionScreen.this.midlet, MilkProductionScreen.this.locale);
+                    MainMenuScreen mainMenuScreen = new MainMenuScreen(MilkProductionScreen.this.midlet, MilkProductionScreen.this.locale, MilkProductionScreen.this.farmer);
                     mainMenuScreen.start();
                 }
             }
diff --git a/web/log/debug.log b/web/log/debug.log
index ba72485..3de5230 100755
--- a/web/log/debug.log
+++ b/web/log/debug.log
@@ -17723,3 +17723,696 @@
 )
 
 [Wednesday, 30th October 2013 17:24:46] [registration.php] New farmer's ID is 29
+[Thursday, 31st October 2013 10:41:54] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 22222
+)
+
+[Thursday, 31st October 2013 10:41:54] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:41:54] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:41:54] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:41:54] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:41:54] [database.php] results gotten from 'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'' are Array
+(
+)
+
+[Thursday, 31st October 2013 10:42:23] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 22222
+)
+
+[Thursday, 31st October 2013 10:42:23] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:42:23] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:42:23] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:42:23] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:42:23] [database.php] results gotten from 'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'' are Array
+(
+)
+
+[Thursday, 31st October 2013 10:58:11] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 22222
+)
+
+[Thursday, 31st October 2013 10:58:11] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:58:11] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:58:11] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 10:58:11] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 10:58:11] [database.php] results gotten from 'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'' are Array
+(
+)
+
+[Thursday, 31st October 2013 11:48:54] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 0722838686
+)
+
+[Thursday, 31st October 2013 11:48:54] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 11:48:54] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 11:48:54] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 11:48:54] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 11:48:54] [database.php] results gotten from 'SELECT * FROM farmer WHERE `mobile_no` = '0722838686'' are Array
+(
+    [0] => Array
+        (
+            [id] => 16
+            [name] => Jason Rogena
+            [mobile_no] => 0722838686
+            [location_county] => 
+            [location_district] => 
+            [gps_longitude] => 
+            [gps_latitude] => 
+            [date_added] => 2013-09-16 12:01:26
+            [extension_personnel_id] => 5
+            [sim_card_sn] => 89254028071000359956
+        )
+
+)
+
+[Thursday, 31st October 2013 11:48:54] [database.php] results gotten from 'SELECT * FROM cow WHERE farmer_id = 16' are Array
+(
+    [0] => Array
+        (
+            [id] => 24
+            [farmer_id] => 16
+            [name] => Betty
+            [ear_tag_number] => nai-jas3
+            [date_of_birth] => 2013-03-16 00:00:00
+            [age] => 26
+            [age_type] => Weeks
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 23
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 14:33:26
+            [service_type] => AI
+            [country_id] => 60
+        )
+
+    [1] => Array
+        (
+            [id] => 25
+            [farmer_id] => 16
+            [name] => Calf3
+            [ear_tag_number] => nai-jas5
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 0
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 15:52:50
+            [service_type] => AI
+            [country_id] => 3
+        )
+
+    [2] => Array
+        (
+            [id] => 23
+            [farmer_id] => 16
+            [name] => Chris
+            [ear_tag_number] => nai-jas2
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 5
+            [age_type] => Weeks
+            [sex] => Male
+            [sire_id] => 
+            [dam_id] => 22
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [3] => Array
+        (
+            [id] => 22
+            [farmer_id] => 16
+            [name] => Rosy
+            [ear_tag_number] => nai-jas1
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 2
+            [age_type] => Years
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [4] => Array
+        (
+            [id] => 26
+            [farmer_id] => 16
+            [name] => Tesr
+            [ear_tag_number] => etd2
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 258
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 17:03:12
+            [service_type] => AI
+            [country_id] => 195
+        )
+
+)
+
+[Thursday, 31st October 2013 12:09:01] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 0722838686
+)
+
+[Thursday, 31st October 2013 12:09:01] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 12:09:01] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 12:09:01] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 12:09:01] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 12:09:01] [database.php] results gotten from 'SELECT * FROM farmer WHERE `mobile_no` = '0722838686'' are Array
+(
+    [0] => Array
+        (
+            [id] => 16
+            [name] => Jason Rogena
+            [mobile_no] => 0722838686
+            [location_county] => 
+            [location_district] => 
+            [gps_longitude] => 
+            [gps_latitude] => 
+            [date_added] => 2013-09-16 12:01:26
+            [extension_personnel_id] => 5
+            [sim_card_sn] => 89254028071000359956
+        )
+
+)
+
+[Thursday, 31st October 2013 12:09:01] [database.php] results gotten from 'SELECT * FROM cow WHERE farmer_id = 16' are Array
+(
+    [0] => Array
+        (
+            [id] => 24
+            [farmer_id] => 16
+            [name] => Betty
+            [ear_tag_number] => nai-jas3
+            [date_of_birth] => 2013-03-16 00:00:00
+            [age] => 26
+            [age_type] => Weeks
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 23
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 14:33:26
+            [service_type] => AI
+            [country_id] => 60
+        )
+
+    [1] => Array
+        (
+            [id] => 25
+            [farmer_id] => 16
+            [name] => Calf3
+            [ear_tag_number] => nai-jas5
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 0
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 15:52:50
+            [service_type] => AI
+            [country_id] => 3
+        )
+
+    [2] => Array
+        (
+            [id] => 23
+            [farmer_id] => 16
+            [name] => Chris
+            [ear_tag_number] => nai-jas2
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 5
+            [age_type] => Weeks
+            [sex] => Male
+            [sire_id] => 
+            [dam_id] => 22
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [3] => Array
+        (
+            [id] => 22
+            [farmer_id] => 16
+            [name] => Rosy
+            [ear_tag_number] => nai-jas1
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 2
+            [age_type] => Years
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [4] => Array
+        (
+            [id] => 26
+            [farmer_id] => 16
+            [name] => Tesr
+            [ear_tag_number] => etd2
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 258
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 17:03:12
+            [service_type] => AI
+            [country_id] => 195
+        )
+
+)
+
+[Thursday, 31st October 2013 12:09:58] [authentication.php] json_decode returned: Array
+(
+    [mobileNumber] => 0722838686
+)
+
+[Thursday, 31st October 2013 12:09:58] [authentication.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 12:09:58] [authentication.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 12:09:58] [database.php] settings obtained: Array
+(
+    [db_name] => ilri_mistro
+    [mysql_creds] => Array
+        (
+            [username] => root
+            [password] => jason
+            [host] => localhost
+        )
+
+    [log_settings] => logs.ini
+    [response_codes] => response_codes.ini
+    [time_zone] => EAT
+)
+
+[Thursday, 31st October 2013 12:09:58] [database.php] response codes are: Array
+(
+    [db_error] => 32243
+    [user_not_authenticated] => 43322
+    [sim_card_registered] => 83242
+    [acknowledge_ok] => 533783
+    [data_error] => 934342
+    [no_data] => 77732
+)
+
+[Thursday, 31st October 2013 12:09:58] [database.php] results gotten from 'SELECT * FROM farmer WHERE `mobile_no` = '0722838686'' are Array
+(
+    [0] => Array
+        (
+            [id] => 16
+            [name] => Jason Rogena
+            [mobile_no] => 0722838686
+            [location_county] => 
+            [location_district] => 
+            [gps_longitude] => 
+            [gps_latitude] => 
+            [date_added] => 2013-09-16 12:01:26
+            [extension_personnel_id] => 5
+            [sim_card_sn] => 89254028071000359956
+        )
+
+)
+
+[Thursday, 31st October 2013 12:09:58] [database.php] results gotten from 'SELECT * FROM cow WHERE farmer_id = 16' are Array
+(
+    [0] => Array
+        (
+            [id] => 24
+            [farmer_id] => 16
+            [name] => Betty
+            [ear_tag_number] => nai-jas3
+            [date_of_birth] => 2013-03-16 00:00:00
+            [age] => 26
+            [age_type] => Weeks
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 23
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 14:33:26
+            [service_type] => AI
+            [country_id] => 60
+        )
+
+    [1] => Array
+        (
+            [id] => 25
+            [farmer_id] => 16
+            [name] => Calf3
+            [ear_tag_number] => nai-jas5
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 0
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 15:52:50
+            [service_type] => AI
+            [country_id] => 3
+        )
+
+    [2] => Array
+        (
+            [id] => 23
+            [farmer_id] => 16
+            [name] => Chris
+            [ear_tag_number] => nai-jas2
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 5
+            [age_type] => Weeks
+            [sex] => Male
+            [sire_id] => 
+            [dam_id] => 22
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [3] => Array
+        (
+            [id] => 22
+            [farmer_id] => 16
+            [name] => Rosy
+            [ear_tag_number] => nai-jas1
+            [date_of_birth] => 0000-00-00 00:00:00
+            [age] => 2
+            [age_type] => Years
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 12:01:26
+            [service_type] => Bull
+            [country_id] => 1
+        )
+
+    [4] => Array
+        (
+            [id] => 26
+            [farmer_id] => 16
+            [name] => Tesr
+            [ear_tag_number] => etd2
+            [date_of_birth] => 2013-09-16 00:00:00
+            [age] => 258
+            [age_type] => Days
+            [sex] => Female
+            [sire_id] => 
+            [dam_id] => 24
+            [straw_id] => 
+            [embryo_id] => 
+            [date_added] => 2013-09-16 17:03:12
+            [service_type] => AI
+            [country_id] => 195
+        )
+
+)
+
diff --git a/web/log/info.log b/web/log/info.log
index e801f22..1449786 100755
--- a/web/log/info.log
+++ b/web/log/info.log
@@ -2481,3 +2481,69 @@
 [Wednesday, 30th October 2013 17:24:46] [general.php] Created a new Extension Personnel record with the name Ij and id as 14
 [Wednesday, 30th October 2013 17:24:46] [database.php] running query INSERT INTO `farmer`(name,`mobile_no`,`gps_longitude`,`gps_latitude`,`extension_personnel_id`,`sim_card_sn`,`date_added`) VALUES('Tip','0874558821','','',14,'','2013-10-30 17:24:46')
 [Wednesday, 30th October 2013 17:24:46] [registration.php] sending acknowledge_ok response cod back to client
+[Thursday, 31st October 2013 10:41:54] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 10:41:54] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 10:41:54] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:41:54] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:41:54] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 10:41:54] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:41:54] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:41:54] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 10:41:54] [database.php] running query SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'
+[Thursday, 31st October 2013 10:41:54] [authentication.php] gracefully exiting
+[Thursday, 31st October 2013 10:42:23] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 10:42:23] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 10:42:23] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:42:23] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:42:23] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 10:42:23] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:42:23] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:42:23] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 10:42:23] [database.php] running query SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'
+[Thursday, 31st October 2013 10:42:23] [authentication.php] gracefully exiting
+[Thursday, 31st October 2013 10:58:11] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 10:58:11] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 10:58:11] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:58:11] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:58:11] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 10:58:11] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 10:58:11] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 10:58:11] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 10:58:11] [database.php] running query SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222'
+[Thursday, 31st October 2013 10:58:11] [authentication.php] gracefully exiting
+[Thursday, 31st October 2013 11:48:54] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 11:48:54] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 11:48:54] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 11:48:54] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 11:48:54] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 11:48:54] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 11:48:54] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 11:48:54] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 11:48:54] [database.php] running query SELECT * FROM farmer WHERE `mobile_no` = '0722838686'
+[Thursday, 31st October 2013 11:48:54] [authentication.php] the mobile number being used (0722838686) is authenticated for 'Jason Rogena'. Sending farmer's name back to client
+[Thursday, 31st October 2013 11:48:54] [database.php] running query SELECT * FROM cow WHERE farmer_id = 16
+[Thursday, 31st October 2013 11:48:54] [authentication.php] gracefully exiting
+[Thursday, 31st October 2013 12:09:01] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 12:09:01] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 12:09:01] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 12:09:01] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 12:09:01] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 12:09:01] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 12:09:01] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 12:09:01] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 12:09:01] [database.php] running query SELECT * FROM farmer WHERE `mobile_no` = '0722838686'
+[Thursday, 31st October 2013 12:09:01] [authentication.php] the mobile number being used (0722838686) is authenticated for 'Jason Rogena'. Sending farmer's name back to client
+[Thursday, 31st October 2013 12:09:01] [database.php] running query SELECT * FROM cow WHERE farmer_id = 16
+[Thursday, 31st October 2013 12:09:01] [authentication.php] gracefully exiting
+[Thursday, 31st October 2013 12:09:58] [authentication.php] Starting Authenticator
+[Thursday, 31st October 2013 12:09:58] [authentication.php] obtaining POST request
+[Thursday, 31st October 2013 12:09:58] [authentication.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 12:09:58] [authentication.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 12:09:58] [database.php] Starting DatabaseHandler
+[Thursday, 31st October 2013 12:09:58] [database.php] getting settings from: ../../config/settings.ini
+[Thursday, 31st October 2013 12:09:58] [database.php] getting response codes from: ../../config/response_codes.ini
+[Thursday, 31st October 2013 12:09:58] [database.php] connecting to ilri_mistro on localhost using root as the username
+[Thursday, 31st October 2013 12:09:58] [database.php] running query SELECT * FROM farmer WHERE `mobile_no` = '0722838686'
+[Thursday, 31st October 2013 12:09:58] [authentication.php] the mobile number being used (0722838686) is authenticated for 'Jason Rogena'. Sending farmer's name back to client
+[Thursday, 31st October 2013 12:09:58] [database.php] running query SELECT * FROM cow WHERE farmer_id = 16
+[Thursday, 31st October 2013 12:09:58] [authentication.php] gracefully exiting
diff --git a/web/log/warning.log b/web/log/warning.log
index fedffbf..195435e 100755
--- a/web/log/warning.log
+++ b/web/log/warning.log
@@ -105,3 +105,9 @@
 [Wednesday, 30th October 2013 17:02:10] [database.php] no results gotten for  'SELECT `id` FROM `extension_personnel` WHERE `name` = 'Jas''
 [Wednesday, 30th October 2013 17:17:11] [database.php] no results gotten for  'SELECT `id` FROM `extension_personnel` WHERE `name` = 'Ron''
 [Wednesday, 30th October 2013 17:24:46] [database.php] no results gotten for  'SELECT `id` FROM `extension_personnel` WHERE `name` = 'Ij''
+[Thursday, 31st October 2013 10:41:54] [database.php] no results gotten for  'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222''
+[Thursday, 31st October 2013 10:41:54] [authentication.php] SIM card serial number () not matching any farmer. Sending user_not_authenticated response code back to client
+[Thursday, 31st October 2013 10:42:23] [database.php] no results gotten for  'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222''
+[Thursday, 31st October 2013 10:42:23] [authentication.php] SIM card serial number () not matching any farmer. Sending user_not_authenticated response code back to client
+[Thursday, 31st October 2013 10:58:11] [database.php] no results gotten for  'SELECT * FROM `farmer` INNER JOIN `cow` ON `farmer`.id = `cow`.`farmer_id` WHERE farmer.`mobile_no` = '22222''
+[Thursday, 31st October 2013 10:58:11] [authentication.php] The mobile number (22222) not matching any farmer. Sending user_not_authenticated response code back to client
diff --git a/web/php/farmer/authentication.php b/web/php/farmer/authentication.php
index 23d0fc6..514df0d 100755
--- a/web/php/farmer/authentication.php
+++ b/web/php/farmer/authentication.php
@@ -22,19 +22,40 @@ class Authenticator {
 		$this->getCodes();
 		$this->database = new DatabaseHandler;
 		
-		$simCardSN=$this->jsonObject['simCardSN'];
-		$query="SELECT `name` FROM `farmer` WHERE `sim_card_sn`='{$simCardSN}'";
-		$result = $this->database->runMySQLQuery($query, true);
-		if(sizeOf($result) == 1) {
-			$farmerName = $result[0]['name'];
-			$this->logHandler->log(3, $this->TAG,"the SIM card serial number being used (".$simCardSN.") is authenticated for '".$farmerName."'. Sending farmer's name back to client");
-			echo $farmerName;
-		}
-		else {
-			$this->logHandler->log(2, $this->TAG,"SIM card serial number (".$simCardSN.") not matching any farmer. Sending user_not_authenticated response code back to client");
-			echo $this->codes['user_not_authenticated'];
-		}
-		$this->logHandler->log(3, $this->TAG,"gracefully exiting");
+                if(isset($this->jsonObject['simCardSN'])){
+                    $simCardSN=$this->jsonObject['simCardSN'];
+                    $query="SELECT `name` FROM `farmer` WHERE `sim_card_sn`='{$simCardSN}'";
+                    $result = $this->database->runMySQLQuery($query, true);
+                    if(sizeOf($result) == 1) {
+                            $farmerName = $result[0]['name'];
+                            $this->logHandler->log(3, $this->TAG,"the SIM card serial number being used (".$simCardSN.") is authenticated for '".$farmerName."'. Sending farmer's name back to client");
+                            echo $farmerName;
+                    }
+                    else {
+                            $this->logHandler->log(2, $this->TAG,"SIM card serial number (".$simCardSN.") not matching any farmer. Sending user_not_authenticated response code back to client");
+                            echo $this->codes['user_not_authenticated'];
+                    }
+                    $this->logHandler->log(3, $this->TAG,"gracefully exiting");                     
+                }
+                else if(isset ($this->jsonObject['mobileNumber'])){
+                    $mobileNumber = $this->jsonObject['mobileNumber'];
+                    $query = "SELECT * FROM farmer WHERE `mobile_no` = '{$mobileNumber}'";
+                    $result = $this->database->runMySQLQuery($query, true);
+                    if(sizeOf($result) == 1) {
+                            $farmer = $result[0];
+                            $this->logHandler->log(3, $this->TAG,"the mobile number being used (".$mobileNumber.") is authenticated for '".$farmer['name']."'. Sending farmer's name back to client");
+                            $query  = "SELECT * FROM cow WHERE farmer_id = {$farmer['id']}";
+                            $cows = $this->database->runMySQLQuery($query, true);
+                            $farmer['cows'] = $cows;
+                            echo json_encode($farmer);
+                    }
+                    else {
+                            $this->logHandler->log(2, $this->TAG,"The mobile number (".$mobileNumber.") not matching any farmer. Sending user_not_authenticated response code back to client");
+                            echo $this->codes['user_not_authenticated'];
+                    }
+                    $this->logHandler->log(3, $this->TAG,"gracefully exiting");
+                }
+		
 	}
 
 	private function getTime($format) {
-- 
2.7.1

